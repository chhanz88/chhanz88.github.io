<!DOCTYPE html>
<html lang="en" dir="auto">

<head><link rel="icon" type="image/png" href="https://chhanz88.github.io/assets/favicon.png">

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chhanz88.github.io" accesskey="h" title="chhanz 기술 블로그
 (Alt + H)">chhanz 기술 블로그
</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chhanz88.github.io/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://chhanz88.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      [ceph] ceph-ansible 을 이용하여 ceph 배포 (containerized deployment)
    </h1>
    <div class="post-description">
       
    </div>
    <div class="post-meta"><span title='2021-02-23 00:00:00 +0000 UTC'>February 23, 2021</span>&nbsp;·&nbsp;chhanz

</div>
  </header> 
  <div class="post-content"><h1 id="ceph-ceph-ansible-을-이용하여-ceph-배포">[ceph] ceph-ansible 을 이용하여 ceph 배포<a hidden class="anchor" aria-hidden="true" href="#ceph-ceph-ansible-을-이용하여-ceph-배포">#</a></h1>
<p><code>ceph-ansible</code> 을 이용하여 ceph 를 배포해보도록 하겠습니다.</p>
<p><em><strong>아래 환경은 ceph 테스트를 위해 배포하는 환경이며 운영 환경에 적합한 환경은 아닙니다.</strong></em></p>
<h3 id="테스트-환경">테스트 환경<a hidden class="anchor" aria-hidden="true" href="#테스트-환경">#</a></h3>
<p><img loading="lazy" src="/assets/images/post/2021-02-23-ceph/testenv.png" alt=""  />
</p>
<ul>
<li>deploy/grafana server : CentOS 7.7</li>
<li>mon/osd #1 : CentOS 7.7
<ul>
<li>osd : /dev/sdb (100g), /dev/sdc (100g)</li>
</ul>
</li>
<li>mon/osd #2 : CentOS 7.7
<ul>
<li>osd : /dev/sdb (100g), /dev/sdc (100g)</li>
</ul>
</li>
<li>mon/osd #3 : CentOS 7.7
<ul>
<li>osd : /dev/sdb (100g), /dev/sdc (100g)</li>
</ul>
</li>
</ul>
<h1 id="배포-준비">배포 준비<a hidden class="anchor" aria-hidden="true" href="#배포-준비">#</a></h1>
<h2 id="clone-ceph-ansible">clone <code>ceph-ansible</code><a hidden class="anchor" aria-hidden="true" href="#clone-ceph-ansible">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># git clone https://github.com/ceph/ceph-ansible.git</span>
</span></span><span style="display:flex;"><span>Cloning into <span style="color:#e6db74">&#39;ceph-ansible&#39;</span>...
</span></span><span style="display:flex;"><span>remote: Enumerating objects: 23, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Counting objects: 100% <span style="color:#f92672">(</span>23/23<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Compressing objects: 100% <span style="color:#f92672">(</span>22/22<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>remote: Total <span style="color:#ae81ff">56802</span> <span style="color:#f92672">(</span>delta 15<span style="color:#f92672">)</span>, reused <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>delta 1<span style="color:#f92672">)</span>, pack-reused <span style="color:#ae81ff">56779</span>
</span></span><span style="display:flex;"><span>Receiving objects: 100% <span style="color:#f92672">(</span>56802/56802<span style="color:#f92672">)</span>, 10.54 MiB | 4.76 MiB/s, <span style="color:#66d9ef">done</span>.
</span></span><span style="display:flex;"><span>Resolving deltas: 100% <span style="color:#f92672">(</span>39491/39491<span style="color:#f92672">)</span>, <span style="color:#66d9ef">done</span>.
</span></span></code></pre></div><p>아래와 같이 checkout 을 하여 ceph version 을 지정합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># cd ceph-ansible/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># git checkout stable-5.0</span>
</span></span><span style="display:flex;"><span>Branch stable-5.0 set up to track remote branch stable-5.0 from origin.
</span></span><span style="display:flex;"><span>Switched to a new branch <span style="color:#e6db74">&#39;stable-5.0&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># git status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># On branch stable-5.0</span>
</span></span><span style="display:flex;"><span>nothing to commit, working directory clean
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><h2 id="inventory-작성">Inventory 작성<a hidden class="anchor" aria-hidden="true" href="#inventory-작성">#</a></h2>
<p>아래와 같이 mon 과 osd 가 같은 서버에 구축이 되도록 inventory 를 작성합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>[<span style="color:#ae81ff">mons]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">mon1    ansible_host=10.50.2.66</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">mon2    ansible_host=10.50.2.67</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">mon3    ansible_host=10.50.2.68</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">osds]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">mon1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">mon2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">mon3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">grafana-server]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">deploy    ansible_host=10.50.2.65</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#ae81ff">all:vars]</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">ansible_ssh_user=root</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">ansible_ssh_pass=testtest</span>
</span></span></code></pre></div><h2 id="group_vars-수정">group_vars 수정<a hidden class="anchor" aria-hidden="true" href="#group_vars-수정">#</a></h2>
<p>아래와 같이 sample yaml 을 이용하여 group_vars 를 수정합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># cd group_vars</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy group_vars<span style="color:#f92672">]</span><span style="color:#75715e"># cp all.yml.sample all.yml        </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy group_vars<span style="color:#f92672">]</span><span style="color:#75715e"># cp osds.yml.sample osds.yml</span>
</span></span></code></pre></div><h3 id="allyml-수정"><code>all.yml</code> 수정<a hidden class="anchor" aria-hidden="true" href="#allyml-수정">#</a></h3>
<p>아래와 같이 변수에 대한 값을 입력합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">dummy</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">ntp_service_enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">ntp_daemon_type</span>: <span style="color:#ae81ff">chronyd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">monitor_interface</span>: <span style="color:#ae81ff">ens160</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">public_network</span>: <span style="color:#ae81ff">10.50.2.0</span><span style="color:#ae81ff">/24</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">cluster_network</span>: <span style="color:#ae81ff">40.40.40.0</span><span style="color:#ae81ff">/24</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">containerized_deployment</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">dashboard_enabled</span>: <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">dashboard_admin_user</span>: <span style="color:#ae81ff">admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">dashboard_admin_password</span>: <span style="color:#ae81ff">P@ssw0rd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">grafana_admin_user</span>: <span style="color:#ae81ff">admin</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">grafana_admin_password</span>: <span style="color:#ae81ff">P@ssw0rd</span>
</span></span></code></pre></div><p>특히 <code>containerized_deployment</code> 는 ceph 를 systemd 가 아닌 container 환경으로 배포하기 위해서는 꼭 설정해야됩니다.</p>
<h3 id="osdsyml-수정"><code>osds.yml</code> 수정<a hidden class="anchor" aria-hidden="true" href="#osdsyml-수정">#</a></h3>
<p>아래와 같이 변수에 대한 값을 입력합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">dummy</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">devices</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">/dev/sdb</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">/dev/sdc</span>
</span></span></code></pre></div><h3 id="site-containeryml-준비"><code>site-container.yml</code> 준비<a hidden class="anchor" aria-hidden="true" href="#site-containeryml-준비">#</a></h3>
<p>아래와 같이 sample file 을 복사합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># cp site-container.yml.sample site-container.yml</span>
</span></span></code></pre></div><h2 id="requirement-package-설치">Requirement Package 설치<a hidden class="anchor" aria-hidden="true" href="#requirement-package-설치">#</a></h2>
<p>아래와 같이 Requirement Package 를 설치합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># yum install python3 python3-pip python3-setuptools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>* python3 venv 생성
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ~<span style="color:#f92672">]</span><span style="color:#75715e"># python3 -m venv py3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-deploy ~<span style="color:#f92672">]</span><span style="color:#75715e"># source py3/bin/activate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>py3<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># pip -V</span>
</span></span><span style="display:flex;"><span>pip 9.0.3 from /root/py3/lib64/python3.6/site-packages <span style="color:#f92672">(</span>python 3.6<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>py3<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># pip install -U pip</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>py3<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># pip install -r requirements.txt</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>py3<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># pip install six</span>
</span></span></code></pre></div><h2 id="ceph-배포">ceph 배포<a hidden class="anchor" aria-hidden="true" href="#ceph-배포">#</a></h2>
<p>아래 명령을 통해 ceph 배포를 시작합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">(</span>py3<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook -i inventory site-container.yml</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>배포 완료
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>PLAY RECAP ********************************************************************************************************************************************************************************deploy                     : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">117</span>  changed<span style="color:#f92672">=</span><span style="color:#ae81ff">26</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>  rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>mon1                       : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">349</span>  changed<span style="color:#f92672">=</span><span style="color:#ae81ff">49</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">529</span>  rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>mon2                       : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">270</span>  changed<span style="color:#f92672">=</span><span style="color:#ae81ff">35</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">472</span>  rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>mon3                       : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">281</span>  changed<span style="color:#f92672">=</span><span style="color:#ae81ff">39</span>   unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">471</span>  rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INSTALLER STATUS **************************************************************************************************************************************************************************Install Ceph Monitor           : Complete <span style="color:#f92672">(</span>0:01:46<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Install Ceph OSD               : Complete <span style="color:#f92672">(</span>0:01:17<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Install Ceph Dashboard         : Complete <span style="color:#f92672">(</span>0:01:23<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Install Ceph Grafana           : Complete <span style="color:#f92672">(</span>0:01:09<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Install Ceph Node Exporter     : Complete <span style="color:#f92672">(</span>0:00:31<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Tuesday <span style="color:#ae81ff">23</span> February <span style="color:#ae81ff">2021</span>  15:36:17 +0900 <span style="color:#f92672">(</span>0:00:00.067<span style="color:#f92672">)</span>       0:12:39.483 ******
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================================</span>
</span></span><span style="display:flex;"><span>ceph-container-common : pulling docker.io/ceph/daemon:latest-octopus image ------------------------------------------------------------------------------------------------------- 163.68s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-container-common/tasks/fetch_image.yml:199 ----------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-container-engine : install container packages -------------------------------------------------------------------------------------------------------------------------------- 84.46s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-container-engine/tasks/pre_requisites/prerequisites.yml:26 ------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>gather and delegate facts --------------------------------------------------------------------------------------------------------------------------------------------------------- 24.72s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/site-container.yml:38 ------------------------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-mon : waiting <span style="color:#66d9ef">for</span> the monitor<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> to form the quorum... ----------------------------------------------------------------------------------------------------------------------- 21.31s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-mon/tasks/ceph_keys.yml:2 ---------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-dashboard : create dashboard admin user -------------------------------------------------------------------------------------------------------------------------------------- 20.83s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-dashboard/tasks/configure_dashboard.yml:141 ---------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-grafana : wait <span style="color:#66d9ef">for</span> grafana to start ------------------------------------------------------------------------------------------------------------------------------------------ 15.52s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-grafana/tasks/configure_grafana.yml:112 -------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-mgr : wait <span style="color:#66d9ef">for</span> all mgr to be up ---------------------------------------------------------------------------------------------------------------------------------------------- 13.90s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-mgr/tasks/mgr_modules.yml:7 -------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-osd : wait <span style="color:#66d9ef">for</span> all osd to be up ---------------------------------------------------------------------------------------------------------------------------------------------- 12.63s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-osd/tasks/main.yml:87 -------------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-grafana : ship systemd service ----------------------------------------------------------------------------------------------------------------------------------------------- 10.97s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-grafana/tasks/systemd.yml:2 -------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-osd : use ceph-volume lvm batch to create bluestore osds --------------------------------------------------------------------------------------------------------------------- 10.77s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-osd/tasks/scenarios/lvm-batch.yml:3 ------------------------------------------------------------------------------------------------------------------------ 
</span></span><span style="display:flex;"><span>ceph-infra : open prometheus port ------------------------------------------------------------------------------------------------------------------------------------------------- 10.76s
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-infra/tasks/dashboard_firewall.yml:40 ---------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-mon : fetch ceph initial keys ------------------------------------------------------------------------------------------------------------------------------------------------- 7.44s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-mon/tasks/ceph_keys.yml:19 --------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-prometheus : write alertmanager config file ----------------------------------------------------------------------------------------------------------------------------------- 5.69s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-prometheus/tasks/main.yml:48 ------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-dashboard : copy self-signed generated certificate on mons -------------------------------------------------------------------------------------------------------------------- 4.88s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-dashboard/tasks/configure_dashboard.yml:73 ----------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-osd : apply operating system tuning ------------------------------------------------------------------------------------------------------------------------------------------- 4.73s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-osd/tasks/system_tuning.yml:50 ----------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-config : create ceph initial directories -------------------------------------------------------------------------------------------------------------------------------------- 4.15s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-config/tasks/create_ceph_initial_dirs.yml:2 ---------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>add modules to ceph-mgr ------------------------------------------------------------------------------------------------------------------------------------------------------------ 4.10s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-mgr/tasks/mgr_modules.yml:40 ------------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-config : create ceph initial directories -------------------------------------------------------------------------------------------------------------------------------------- 3.96s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-config/tasks/create_ceph_initial_dirs.yml:2 ---------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-container-common : get ceph version ------------------------------------------------------------------------------------------------------------------------------------------- 3.87s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-container-common/tasks/main.yml:13 ------------------------------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span>ceph-container-engine : start container service ------------------------------------------------------------------------------------------------------------------------------------ 3.52s 
</span></span><span style="display:flex;"><span>/root/ceph-ansible/roles/ceph-container-engine/tasks/pre_requisites/prerequisites.yml:81 ------------------------------------------------------------------------------------------------- 
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>py3<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>root@ceph-deploy ceph-ansible<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><h1 id="서비스-점검">서비스 점검<a hidden class="anchor" aria-hidden="true" href="#서비스-점검">#</a></h1>
<p>Container 로 구성된 ceph 는 아래와 같은 방법으로 mgr 에 ceph 명령을 입력하고 ceph 를 운영 할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-s1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec ceph-mgr-ceph-s1 ceph -s</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    id:     98b454c8-a44a-41c7-a11d-a20f6d37b672
</span></span><span style="display:flex;"><span>    health: HEALTH_OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services:
</span></span><span style="display:flex;"><span>    mon: <span style="color:#ae81ff">3</span> daemons, quorum ceph-s1,ceph-s2,ceph-s3 <span style="color:#f92672">(</span>age 29m<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    mgr: ceph-s1<span style="color:#f92672">(</span>active, since 24m<span style="color:#f92672">)</span>, standbys: ceph-s2, ceph-s3
</span></span><span style="display:flex;"><span>    osd: <span style="color:#ae81ff">6</span> osds: <span style="color:#ae81ff">6</span> up <span style="color:#f92672">(</span>since 27m<span style="color:#f92672">)</span>, <span style="color:#ae81ff">6</span> in <span style="color:#f92672">(</span>since 27m<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  data:
</span></span><span style="display:flex;"><span>    pools:   <span style="color:#ae81ff">2</span> pools, <span style="color:#ae81ff">33</span> pgs
</span></span><span style="display:flex;"><span>    objects: <span style="color:#ae81ff">0</span> objects, <span style="color:#ae81ff">0</span> B
</span></span><span style="display:flex;"><span>    usage:   6.0 GiB used, <span style="color:#ae81ff">594</span> GiB / <span style="color:#ae81ff">600</span> GiB avail
</span></span><span style="display:flex;"><span>    pgs:     <span style="color:#ae81ff">33</span> active+clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-s1 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-s1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec ceph-mgr-ceph-s1 ceph mon dump </span>
</span></span><span style="display:flex;"><span>epoch <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>fsid 98b454c8-a44a-41c7-a11d-a20f6d37b672
</span></span><span style="display:flex;"><span>last_changed 2021-02-23T15:30:24.754250+0900
</span></span><span style="display:flex;"><span>created 2021-02-23T15:30:24.754250+0900
</span></span><span style="display:flex;"><span>min_mon_release <span style="color:#ae81ff">15</span> <span style="color:#f92672">(</span>octopus<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>0: <span style="color:#f92672">[</span>v2:10.50.2.66:3300/0,v1:10.50.2.66:6789/0<span style="color:#f92672">]</span> mon.ceph-s1
</span></span><span style="display:flex;"><span>1: <span style="color:#f92672">[</span>v2:10.50.2.67:3300/0,v1:10.50.2.67:6789/0<span style="color:#f92672">]</span> mon.ceph-s2
</span></span><span style="display:flex;"><span>2: <span style="color:#f92672">[</span>v2:10.50.2.68:3300/0,v1:10.50.2.68:6789/0<span style="color:#f92672">]</span> mon.ceph-s3
</span></span><span style="display:flex;"><span>dumped monmap epoch <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-s1 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><h1 id="ceph-dashboard">ceph dashboard<a hidden class="anchor" aria-hidden="true" href="#ceph-dashboard">#</a></h1>
<p>아래와 같이 mgr IP 를 통해 ceph dashboard 에 접속 할 수 있습니다. (<code>https://mgr IP:8443</code>)</p>
<p><img loading="lazy" src="/assets/images/post/2021-02-23-ceph/login.png" alt=""  />
<br>
<img loading="lazy" src="/assets/images/post/2021-02-23-ceph/status.png" alt=""  />
</p>
<h1 id="참고-문서">참고 문서<a hidden class="anchor" aria-hidden="true" href="#참고-문서">#</a></h1>
<ul>
<li><a href="https://docs.ceph.com/projects/ceph-ansible/en/latest/index.html">https://docs.ceph.com/projects/ceph-ansible/en/latest/index.html</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://chhanz88.github.io/tags/ceph/">ceph</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://chhanz88.github.io">chhanz 기술 블로그
</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
