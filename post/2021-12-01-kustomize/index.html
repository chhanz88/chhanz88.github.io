<!DOCTYPE html>
<html lang="en" dir="auto">

<head><link rel="icon" type="image/png" href="https://chhanz88.github.io/assets/favicon.png">

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chhanz88.github.io" accesskey="h" title="chhanz 기술 블로그
 (Alt + H)">chhanz 기술 블로그
</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chhanz88.github.io/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://chhanz88.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      [Kubernetes] Kustomize 
    </h1>
    <div class="post-meta"><span title='2021-12-01 00:00:00 +0000 UTC'>December 1, 2021</span>&nbsp;·&nbsp;chhanz

</div>
  </header> 
  <div class="post-content"><h1 id="목차">목차<a hidden class="anchor" aria-hidden="true" href="#목차">#</a></h1>
<ul>
<li><a href="#info">Kustomize 란?</a></li>
<li><a href="#install">Kustomize 설치</a></li>
<li><a href="#completion">Completion 설정</a></li>
<li><a href="#base">Kustomize 기본</a>
<ul>
<li><a href="#build">Kustomize build</a></li>
<li><a href="#run">Run kustomize</a></li>
<li><a href="#resource"><code>resources</code> 추가</a></li>
<li><a href="#patch"><code>patch</code></a></li>
<li><a href="#prefixlabel"><code>prefix/label</code></a></li>
<li><a href="#secretgenerator"><code>secretGenerator</code> 이용</a></li>
<li><a href="#overlay">overlay 적용</a></li>
</ul>
</li>
<li><a href="#refdoc">참고 자료</a></li>
</ul>
<h1 id="info">Kustomize 란?<a hidden class="anchor" aria-hidden="true" href="#info">#</a></h1>
<p>Kustomize는 쿠버네티스 구성을 사용자 정의화하는 도구이다. 이는 애플리케이션 구성 파일을 관리하기 위해 다음 기능들을 가진다.</p>
<ul>
<li>다른 소스에서 리소스 생성</li>
<li>리소스에 대한 교차 편집 필드 설정</li>
<li>리소스 집합을 구성하고 사용자 정의<br>
<a href="https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/kustomization/#kustomize-%EA%B0%9C%EC%9A%94">(https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/kustomization/#kustomize-%EA%B0%9C%EC%9A%94 발췌)</a></li>
</ul>
<p><em><strong>개인적으론 <code>Helm</code> 보다 <code>Kustomize</code> 가 사용하기 좋았다.</strong></em></p>
<h1 id="install">Kustomize 설치<a hidden class="anchor" aria-hidden="true" href="#install">#</a></h1>
<p>아래 명령어를 통해 OS 에 맞게 자동으로 설치 진행된다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~# curl -s <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh&#34;</span>  | bash
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>Version:kustomize/v4.4.0 GitCommit:63ec6bdb3d737a7c66901828c5743656c49b60e1 BuildDate:2021-09-27T16:24:12Z GoOs:linux GoArch:amd64<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>kustomize installed to //root/kustomize
</span></span></code></pre></div><p>사용의 편의를 위해 Path 를 이동하였다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~# mv kustomize /usr/local/bin/
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>root@node1:~# kustomize --help
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Manages declarative configuration of Kubernetes.
</span></span><span style="display:flex;"><span>See https://sigs.k8s.io/kustomize
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span>  kustomize <span style="color:#f92672">[</span>command<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Available Commands:
</span></span><span style="display:flex;"><span>  build                     Build a kustomization target from a directory or URL.
</span></span><span style="display:flex;"><span>  cfg                       Commands <span style="color:#66d9ef">for</span> reading and writing configuration.
</span></span><span style="display:flex;"><span>  completion                Generate shell completion script
</span></span><span style="display:flex;"><span>  create                    Create a new kustomization in the current directory
</span></span><span style="display:flex;"><span>  edit                      Edits a kustomization file
</span></span><span style="display:flex;"><span>  fn                        Commands <span style="color:#66d9ef">for</span> running functions against configuration.
</span></span><span style="display:flex;"><span>  help                      Help about any command
</span></span><span style="display:flex;"><span>  version                   Prints the kustomize version
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Flags:
</span></span><span style="display:flex;"><span>  -h, --help          help <span style="color:#66d9ef">for</span> kustomize
</span></span><span style="display:flex;"><span>      --stack-trace   print a stack-trace on error
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Additional help topics:
</span></span><span style="display:flex;"><span>  kustomize docs-fn                   <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Documentation <span style="color:#66d9ef">for</span> developing and invoking Configuration Functions.
</span></span><span style="display:flex;"><span>  kustomize docs-fn-spec              <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Documentation <span style="color:#66d9ef">for</span> Configuration Functions Specification.
</span></span><span style="display:flex;"><span>  kustomize docs-io-annotations       <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Documentation <span style="color:#66d9ef">for</span> annotations used by io.
</span></span><span style="display:flex;"><span>  kustomize docs-merge                <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Documentation <span style="color:#66d9ef">for</span> merging Resources <span style="color:#f92672">(</span>2-way merge<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>  kustomize docs-merge3               <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Documentation <span style="color:#66d9ef">for</span> merging Resources <span style="color:#f92672">(</span>3-way merge<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>  kustomize tutorials-command-basics  <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Tutorials <span style="color:#66d9ef">for</span> using basic config commands.
</span></span><span style="display:flex;"><span>  kustomize tutorials-function-basics <span style="color:#f92672">[</span>Alpha<span style="color:#f92672">]</span> Tutorials <span style="color:#66d9ef">for</span> using functions.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>Use <span style="color:#e6db74">&#34;kustomize [command] --help&#34;</span> <span style="color:#66d9ef">for</span> more information about a command.
</span></span></code></pre></div><h1 id="completion">Completion 설정<a hidden class="anchor" aria-hidden="true" href="#completion">#</a></h1>
<p>아래 명령어를 통해 completion 을 설정한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize completion bash &gt; /etc/bash_completion.d/kustomize
</span></span></code></pre></div><h1 id="base">Kustomize 기본<a hidden class="anchor" aria-hidden="true" href="#base">#</a></h1>
<p>Kustomize 의 테스트를 위해 flask 예제 어플리케이션을 준비한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kubectl create deployment --image<span style="color:#f92672">=</span>quay.io/chhanz/flask-example-app flash-app -o yaml --dry-run &gt; deployment.yml
</span></span><span style="display:flex;"><span>W1110 13:11:30.171887   <span style="color:#ae81ff">79409</span> helpers.go:553<span style="color:#f92672">]</span> --dry-run is deprecated and can be replaced with --dry-run<span style="color:#f92672">=</span>client.
</span></span></code></pre></div><p>아래와 같이 <code>kustomization.yaml</code> 을 작성한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# cat kustomization.yaml
</span></span><span style="display:flex;"><span>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span><span style="display:flex;"><span>kind: Kustomization
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>resources:
</span></span><span style="display:flex;"><span>- base/deployment.yml               <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span></code></pre></div><p>위 <code>kustomization.yaml</code> 은 아래와 같은 파일 구조를 가진다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>├── base
</span></span><span style="display:flex;"><span>│   └── deployment.yml
</span></span><span style="display:flex;"><span>└── kustomization.yaml
</span></span></code></pre></div><p>kustomize 의 기본은 <code>resources</code> 부분에 어플리케이션을 선언하면 된다.</p>
<h2 id="build">Kustomize build<a hidden class="anchor" aria-hidden="true" href="#build">#</a></h2>
<p>아래 명령어를 통해 작성한 <code>kustomization.yaml</code> 를 kubernetes 에 맞는 <code>yaml</code> 형식으로 변환 할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build
</span></span><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  creationTimestamp: null
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: flash-app
</span></span><span style="display:flex;"><span>  name: flash-app
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>      app: flash-app
</span></span><span style="display:flex;"><span>  strategy: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      creationTimestamp: null
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        app: flash-app
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - image: quay.io/chhanz/flask-example-app
</span></span><span style="display:flex;"><span>        name: flask-example-app
</span></span><span style="display:flex;"><span>        resources: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>status: <span style="color:#f92672">{}</span>
</span></span></code></pre></div><h2 id="run">Run kustomize<a hidden class="anchor" aria-hidden="true" href="#run">#</a></h2>
<p>생성한 <code>kustomization.yaml</code> 을 이용하여 아래와 같이 어플리케이션을 배포 할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build | kubectl create -f  -           <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>deployment.apps/flash-app created
</span></span><span style="display:flex;"><span>root@node1:~/test#
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>root@node1:~/test# kubectl get all
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/flash-app-69f5f676d6-z7wf4   1/1     Running   <span style="color:#ae81ff">0</span>          14s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>   AGE
</span></span><span style="display:flex;"><span>service/kubernetes   ClusterIP   10.233.0.1   &lt;none&gt;        443/TCP   131m
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/flash-app   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           14s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                                   DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>replicaset.apps/flash-app-69f5f676d6   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       14s
</span></span></code></pre></div><h2 id="resource"><code>resources</code> 추가<a hidden class="anchor" aria-hidden="true" href="#resource">#</a></h2>
<p>만들어둔 <code>kustomize</code> 에 신규 리소스 <code>service</code> 를 추가해본다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# cat kustomization.yaml
</span></span><span style="display:flex;"><span>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span><span style="display:flex;"><span>kind: Kustomization
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>resources:
</span></span><span style="display:flex;"><span>- base/deployment.yml
</span></span><span style="display:flex;"><span>- base/service.yml              <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span></code></pre></div><p>추가한 <code>kustomize</code> 를 kubernetes 에 배포한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build . | kubectl create -f -
</span></span><span style="display:flex;"><span>service/flask-app created
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kubectl get all
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/flask-app-669644b479-vh969   1/1     Running   <span style="color:#ae81ff">0</span>          31s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>   AGE
</span></span><span style="display:flex;"><span>service/flask-app    ClusterIP   10.233.27.235   &lt;none&gt;        80/TCP    31s        <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>service/kubernetes   ClusterIP   10.233.0.1      &lt;none&gt;        443/TCP   3h3m
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/flask-app   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           31s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                                   DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>replicaset.apps/flask-app-669644b479   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       31s
</span></span></code></pre></div><p>위와 같이 서비스가 생성 된 것을 확인 할 수 있다.</p>
<h1 id="patch"><code>patch</code><a hidden class="anchor" aria-hidden="true" href="#patch">#</a></h1>
<p><code>kustomize</code> 는 resource 의 spec 별로 <code>patch</code> 를 이용하여 Base <code>yaml</code> 을 수정안하고 전체 어플리케이션을 수정 할 수 있다.<br>
예를 들면 service 의 속성만 기존과 다르게 변경도 할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# cat patch/svc-nodeport.yml
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Service
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  creationTimestamp: null
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>  name: flask-app
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  type: NodePort
</span></span></code></pre></div><p>위는 기존에 <code>ClusterIP</code> 로 선언된 <code>type</code> 을 <code>NodePort</code> 로 <code>patch</code> 하는 yaml 이다.<br>
해당 yaml 을 작성하고 아래와 같이 <code>kustomization.yaml</code>에 추가한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# cat kustomization.yaml
</span></span><span style="display:flex;"><span>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span><span style="display:flex;"><span>kind: Kustomization
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>resources:
</span></span><span style="display:flex;"><span>- base/deployment.yml
</span></span><span style="display:flex;"><span>- base/service.yml
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>patches:
</span></span><span style="display:flex;"><span>- patch/svc-nodeport.yml            <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span></code></pre></div><p>위와 같이 작성한 <code>kustomization.yaml</code> 을 build 해서 확인해보면,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build .
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Service
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>  name: flask-app
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  ports:
</span></span><span style="display:flex;"><span>  - port: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    protocol: TCP
</span></span><span style="display:flex;"><span>    targetPort: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>  type: NodePort                    <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>status:
</span></span><span style="display:flex;"><span>  loadBalancer: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>... 생략 ...
</span></span></code></pre></div><p><code>ClusterIP</code> 에서 <code>NodePort</code> 로 변경 된 것을 볼 수 있다.</p>
<p>변경된 <code>kustomize</code> 를 배포한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build . | kubectl apply -f -
</span></span><span style="display:flex;"><span>Warning: resource services/flask-app is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl
</span></span><span style="display:flex;"><span>create --save-config or kubectl apply. The missing annotation will be patched automatically.
</span></span><span style="display:flex;"><span>service/flask-app configured
</span></span><span style="display:flex;"><span>Warning: resource deployments/flask-app is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
</span></span><span style="display:flex;"><span>deployment.apps/flask-app configured
</span></span></code></pre></div><p>서비스 확인.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kubectl get all
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS        RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/flask-app-669644b479-4gjwz   1/1     Terminating   <span style="color:#ae81ff">0</span>          2m58s
</span></span><span style="display:flex;"><span>pod/flask-app-669644b479-4lscv   1/1     Running       <span style="color:#ae81ff">0</span>          5s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
</span></span><span style="display:flex;"><span>service/flask-app    NodePort    10.233.49.196   &lt;none&gt;        80:32312/TCP   5s                <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>service/kubernetes   ClusterIP   10.233.0.1      &lt;none&gt;        443/TCP        3h17m
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/flask-app   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           5s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                                   DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>replicaset.apps/flask-app-669644b479   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       5s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@node1:~/test# curl node6:32312
</span></span><span style="display:flex;"><span> Container LAB | POD Working : flask-app-669644b479-4lscv | v<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>root@node1:~/test# curl node5:32312
</span></span><span style="display:flex;"><span> Container LAB | POD Working : flask-app-669644b479-4lscv | v<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>root@node1:~/test# curl node4:32312
</span></span><span style="display:flex;"><span> Container LAB | POD Working : flask-app-669644b479-4lscv | v<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p><code>NodePort</code> 로 <code>Patch</code>가 되었다.</p>
<h1 id="prefixlabel"><code>prefix/label</code><a hidden class="anchor" aria-hidden="true" href="#prefixlabel">#</a></h1>
<p>유용한 옵션으로 prefix 와 label 설정이 있다.<br>
해당 옵션은 배포되는 어플리케이션에 리소스에 prefix 이름을 넣고 label 을 설정하는 옵션이다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# cat kustomization.yaml
</span></span><span style="display:flex;"><span>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span><span style="display:flex;"><span>kind: Kustomization
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>resources:
</span></span><span style="display:flex;"><span>- base/deployment.yml
</span></span><span style="display:flex;"><span>- base/service.yml
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>namePrefix: prefix-                     <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>commonLabels:
</span></span><span style="display:flex;"><span>  t_label: testtest                     <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>patches:
</span></span><span style="display:flex;"><span>- patch/svc-nodeport.yml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kubectl get all -l t_label -o wide
</span></span><span style="display:flex;"><span>NAME                                    READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES
</span></span><span style="display:flex;"><span>pod/prefix-flask-app-7df7849944-wr9bs   1/1     Running   <span style="color:#ae81ff">0</span>          17s   10.233.70.1   node5   &lt;none&gt;           &lt;none&gt;
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                       TYPE       CLUSTER-IP     EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE   SELECTOR
</span></span><span style="display:flex;"><span>service/prefix-flask-app   NodePort   10.233.5.176   &lt;none&gt;        80:32705/TCP   18s   app<span style="color:#f92672">=</span>flask-app,t_label<span style="color:#f92672">=</span>testtest
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS          IMAGES                             SELECTOR
</span></span><span style="display:flex;"><span>deployment.apps/prefix-flask-app   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           18s   flask-example-app   quay.io/chhanz/flask-example-app   app<span style="color:#f92672">=</span>flask-app,t_label<span style="color:#f92672">=</span>testtest
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                                          DESIRED   CURRENT   READY   AGE   CONTAINERS          IMAGES                             SELECTOR
</span></span><span style="display:flex;"><span>replicaset.apps/prefix-flask-app-7df7849944   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       18s   flask-example-app   quay.io/chhanz/flask-example-app   app<span style="color:#f92672">=</span>flask-app,pod-template-hash<span style="color:#f92672">=</span>7df7849944,t_label<span style="color:#f92672">=</span>testtest
</span></span></code></pre></div><p>위와 같이 prefix 로 설정한 <code>prefix-</code> 가 각 리소스에 name 으로 설정되었고, label 도 <code>t_label=testtest</code> 가 추가된 것을 볼 수 있다.</p>
<h1 id="secretgenerator">secretGenerator 이용<a hidden class="anchor" aria-hidden="true" href="#secretgenerator">#</a></h1>
<p>kustomize 를 통해 secret 도 관리 할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test/base# cat test.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>test<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span>testtest
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">=</span>test.conf
</span></span><span style="display:flex;"><span>description<span style="color:#f92672">=</span>testtest config
</span></span></code></pre></div><p>위 내용은 secret 으로 mount 할 test config 이다.</p>
<p>base deployment 수정</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test/base# cat deployment.yml
</span></span><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>... 생략 ...
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - image: quay.io/chhanz/flask-example-app
</span></span><span style="display:flex;"><span>        name: flask-example-app
</span></span><span style="display:flex;"><span>        volumeMounts:
</span></span><span style="display:flex;"><span>        - name: mount-secret                                <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>          mountPath: <span style="color:#e6db74">&#34;/usr/src/app/data&#34;</span>      
</span></span><span style="display:flex;"><span>        resources: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>      volumes:
</span></span><span style="display:flex;"><span>      - name: mount-secret
</span></span><span style="display:flex;"><span>        secret:
</span></span><span style="display:flex;"><span>          secretName: mount-test-secret                      <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span></code></pre></div><p>위와 같이 해당 어플리케이션은 <code>mount-test-secret</code> 이름의 secret 을 pod 에 mount 하도록 되어 있다.</p>
<p><code>kustomization.yaml</code> 작성</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test/base# cat kustomization.yaml
</span></span><span style="display:flex;"><span>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span><span style="display:flex;"><span>kind: Kustomization
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>resources:
</span></span><span style="display:flex;"><span>- deployment.yml
</span></span><span style="display:flex;"><span>- service.yml
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>namePrefix: prefix-
</span></span><span style="display:flex;"><span>commonLabels:
</span></span><span style="display:flex;"><span>  app: flask-app
</span></span><span style="display:flex;"><span>  t_label: testtest
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>secretGenerator:                    <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>- name: mount-test-secret
</span></span><span style="display:flex;"><span>  files:
</span></span><span style="display:flex;"><span>  - test.conf
</span></span><span style="display:flex;"><span>  type: Opaque
</span></span></code></pre></div><p>secretGenerator 를 이용하여 <code>mount-test-secret</code> 이름의 secret 을 생성한다.</p>
<p>build 를 하면 아래와 같은 yaml 을 볼 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test/base# kustomize build .
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>data:
</span></span><span style="display:flex;"><span>  test.conf: |                                                                          <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>    W3Rlc3RdCm5hbWU9dGVzdHRlc3QKY29uZmlnPXRlc3QuY29uZgpkZXNjcmlwdGlvbj10ZX              <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>    N0dGVzdCBjb25maWcK                                                                  <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span><span style="display:flex;"><span>kind: Secret
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>    t_label: testtest
</span></span><span style="display:flex;"><span>  name: prefix-moun-test-secret-6c8d796cc7
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>... 생략
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>... 생략
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>      volumes:
</span></span><span style="display:flex;"><span>      - name: mount-secret
</span></span><span style="display:flex;"><span>        secret:
</span></span><span style="display:flex;"><span>          secretName: prefix-moun-test-secret-6c8d796cc7                                <span style="color:#f92672">&lt;&lt;&lt;</span>
</span></span></code></pre></div><p>secret 들에 hash 들이 붙으면서 자동으로 base yaml 을 수정, 적용한다.</p>
<p>해당 어플리케이션을 배포하고 secret 이 mount 되었는지 확인한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;&lt;K9s-Shell&gt;&gt; Pod: default/prefix-flask-app-787d6569db-k6f98 | Container: flask-example-app
</span></span><span style="display:flex;"><span>/usr/src/app <span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>Dockerfile        data              main.py           requirements.txt
</span></span><span style="display:flex;"><span>/usr/src/app <span style="color:#75715e"># cat data/test.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>test<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span>testtest
</span></span><span style="display:flex;"><span>config<span style="color:#f92672">=</span>test.conf
</span></span><span style="display:flex;"><span>description<span style="color:#f92672">=</span>testtest config
</span></span><span style="display:flex;"><span>/usr/src/app <span style="color:#75715e">#</span>
</span></span></code></pre></div><h1 id="overlay">overlay 적용<a hidden class="anchor" aria-hidden="true" href="#overlay">#</a></h1>
<p>base yaml 을 다른 kubernetes cluster 혹은 namespace 에 배포를 쉽게 하기 위해 overlay 를 적용 할 수 있다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kubectl create ns prod
</span></span><span style="display:flex;"><span>namespace/prod created
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>root@node1:~/test# tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── base
</span></span><span style="display:flex;"><span>│   ├── deployment.yml
</span></span><span style="display:flex;"><span>│   ├── kustomization.yaml
</span></span><span style="display:flex;"><span>│   └── service.yml
</span></span><span style="display:flex;"><span>├── overlays
</span></span><span style="display:flex;"><span>│   └── prod
</span></span><span style="display:flex;"><span>│       └── kustomization.yaml
</span></span><span style="display:flex;"><span>└── patch
</span></span><span style="display:flex;"><span>    └── svc-nodeport.yml
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> directories, <span style="color:#ae81ff">5</span> file
</span></span></code></pre></div><p>위와 같이 테스트를 위해 <code>prod</code> 라는 namespace 를 생성하고 <code>overlays/prod/kustomizetion.yaml</code> 을 생성한다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# cat overlays/prod/kustomization.yaml
</span></span><span style="display:flex;"><span>apiVersion: kustomize.config.k8s.io/v1beta1
</span></span><span style="display:flex;"><span>kind: Kustomization
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>bases:
</span></span><span style="display:flex;"><span>- ../../base
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>namespace: prod
</span></span></code></pre></div><p>위와 같이 <code>bases</code> 는 기존에 <code>default</code> namespace 에 배포 되는 어플리케이션을 <code>prod</code> namespace 로 변경하는 <code>kustomization.yaml</code> 이다.<br>
간단히 설명하면 <code>bases</code> 에 있는 어플리케이션을 다른 overlay 인 <code>prod</code> namespace 로 배포하게 된다.</p>
<p>build 를 해보면,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build  overlays/prod/
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Service
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  creationTimestamp: null
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>    t_label: testtest
</span></span><span style="display:flex;"><span>  name: prefix-flask-app
</span></span><span style="display:flex;"><span>  namespace: prod
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  ports:
</span></span><span style="display:flex;"><span>  - port: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    protocol: TCP
</span></span><span style="display:flex;"><span>    targetPort: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>    t_label: testtest
</span></span><span style="display:flex;"><span>status:
</span></span><span style="display:flex;"><span>  loadBalancer: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>apiVersion: apps/v1
</span></span><span style="display:flex;"><span>kind: Deployment
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  creationTimestamp: null
</span></span><span style="display:flex;"><span>  labels:
</span></span><span style="display:flex;"><span>    app: flask-app
</span></span><span style="display:flex;"><span>    t_label: testtest
</span></span><span style="display:flex;"><span>  name: prefix-flask-app
</span></span><span style="display:flex;"><span>  namespace: prod
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  selector:
</span></span><span style="display:flex;"><span>    matchLabels:
</span></span><span style="display:flex;"><span>      app: flask-app
</span></span><span style="display:flex;"><span>      t_label: testtest
</span></span><span style="display:flex;"><span>  strategy: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    metadata:
</span></span><span style="display:flex;"><span>      creationTimestamp: null
</span></span><span style="display:flex;"><span>      labels:
</span></span><span style="display:flex;"><span>        app: flask-app
</span></span><span style="display:flex;"><span>        t_label: testtest
</span></span><span style="display:flex;"><span>    spec:
</span></span><span style="display:flex;"><span>      containers:
</span></span><span style="display:flex;"><span>      - image: quay.io/chhanz/flask-example-app
</span></span><span style="display:flex;"><span>        name: flask-example-app
</span></span><span style="display:flex;"><span>        resources: <span style="color:#f92672">{}</span>
</span></span><span style="display:flex;"><span>status: <span style="color:#f92672">{}</span>
</span></span></code></pre></div><p>위와 같은 yaml 을 생성되고 어플리케이션을 배포하면,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@node1:~/test# kustomize build  overlays/prod/ | kubectl create -f -
</span></span><span style="display:flex;"><span>service/prefix-flask-app created
</span></span><span style="display:flex;"><span>deployment.apps/prefix-flask-app created
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@node1:~/test# kubectl get all -n prod
</span></span><span style="display:flex;"><span>NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pod/prefix-flask-app-7df7849944-chbsb   1/1     Running   <span style="color:#ae81ff">0</span>          6s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>   AGE
</span></span><span style="display:flex;"><span>service/prefix-flask-app   ClusterIP   10.233.17.231   &lt;none&gt;        80/TCP    7s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>deployment.apps/prefix-flask-app   1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           6s
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>replicaset.apps/prefix-flask-app-7df7849944   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       6s
</span></span></code></pre></div><p>위와 같이 <code>prod</code> namespace 에 어플리케이션이 배포 된 것을 볼 수 있다.</p>
<h1 id="refdoc">참고 자료<a hidden class="anchor" aria-hidden="true" href="#refdoc">#</a></h1>
<ul>
<li><a href="https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/kustomization/">https://kubernetes.io/ko/docs/tasks/manage-kubernetes-objects/kustomization/</a></li>
<li><a href="https://www.jacobbaek.com/1172">https://www.jacobbaek.com/1172</a></li>
<li><a href="https://github.com/kubernetes-sigs/kustomize">https://github.com/kubernetes-sigs/kustomize</a></li>
<li><a href="https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/">https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://chhanz88.github.io/tags/kubernetes/">kubernetes</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://chhanz88.github.io">chhanz 기술 블로그
</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
