<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>[GPFS] CentOS 7 - IBM GPFS Hands on Tranining | chhanz 기술 블로그
</title>
<meta name="keywords" content="linux, GPFS">
<meta name="description" content=" ">
<meta name="author" content="chhanz">
<link rel="canonical" href="https://chhanz88.github.io/post/2019-04-05-linux-gpfs-hands-on-training/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js" integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" type="image/png" href="https://chhanz88.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://chhanz88.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://chhanz88.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://chhanz88.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://chhanz88.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="[GPFS] CentOS 7 - IBM GPFS Hands on Tranining" />
<meta property="og:description" content=" " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chhanz88.github.io/post/2019-04-05-linux-gpfs-hands-on-training/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-04-05T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2019-04-05T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[GPFS] CentOS 7 - IBM GPFS Hands on Tranining"/>
<meta name="twitter:description" content=" "/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://chhanz88.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "[GPFS] CentOS 7 - IBM GPFS Hands on Tranining",
      "item": "https://chhanz88.github.io/post/2019-04-05-linux-gpfs-hands-on-training/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "[GPFS] CentOS 7 - IBM GPFS Hands on Tranining",
  "name": "[GPFS] CentOS 7 - IBM GPFS Hands on Tranining",
  "description": " ",
  "keywords": [
    "linux", "GPFS"
  ],
  "articleBody": "[GPFS] CentOS 7 - IBM GPFS Hands on Tranining 목표 Hands-on 구성도  Hands-on 환경   OS Version : CentOS 7.3\nKernel Version : 3.10.0-514.el7.x86_64\nGPFS Version : gpfs v4.2.2-3\nOS Configuration : SSH Key Copy 완료\n Hands-on Lab Cluster 구성\n[root@gpfs1 desc]# mmcrcluster -N node_desc --ccr-disable -p gpfs1 -s gpfs2 -r /usr/bin/ssh -R /usr/bin/scp -C gpfscluster mmcrcluster: Performing preliminary node verification ... mmcrcluster: Processing quorum and other critical nodes ... mmcrcluster: Finalizing the cluster data structures ... mmcrcluster: Command successfully completed mmcrcluster: Warning: Not all nodes have proper GPFS license designations. Use the mmchlicense command to designate licenses as needed. mmcrcluster: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. [root@gpfs1 desc]# [root@gpfs1 desc]# mmchlicense server --accept -N gpfs1,gpfs2 The following nodes will be designated as possessing server licenses: gpfs1 gpfs2 mmchlicense: Command successfully completed mmchlicense: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. [root@gpfs1 desc]# GPFS portability layer 생성\n[root@gpfs1 desc]# mmbuildgpl --build-package -------------------------------------------------------- mmbuildgpl: Building GPL module begins at Thu Apr 4 20:49:28 KST 2019. -------------------------------------------------------- Verifying Kernel Header... kernel version = 31000514 (3.10.0-514.el7.x86_64, 3.10.0-514) module include dir = /lib/modules/3.10.0-514.el7.x86_64/build/include module build dir = /lib/modules/3.10.0-514.el7.x86_64/build kernel source dir = /usr/src/linux-3.10.0-514.el7.x86_64/include Found valid kernel header file under /usr/src/kernels/3.10.0-514.el7.x86_64/include Verifying Compiler... make is present at /bin/make cpp is present at /bin/cpp gcc is present at /bin/gcc g++ is present at /bin/g++ ld is present at /bin/ld Verifying rpmbuild... Verifying Additional System Headers... Verifying kernel-headers is installed ... Command: /bin/rpm -q kernel-headers The required package kernel-headers is installed make World ... make InstallImages ... make rpm ... Wrote: /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm -------------------------------------------------------- mmbuildgpl: Building GPL module completed successfully at Thu Apr 4 20:50:08 KST 2019. -------------------------------------------------------- [root@gpfs1 desc]# Node1 build 된 package 설치\n# yum install /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm Loaded plugins: fastestmirror Examining /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm: gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64 Marking /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm to be installed Resolving Dependencies -- Running transaction check --- Package gpfs.gplbin-3.10.0-514.el7.x86_64.x86_64 0:4.2.2-3 will be installed -- Finished Dependency Resolution Dependencies Resolved =================================================================================================================================================================================================================== Package Arch Version Repository Size =================================================================================================================================================================================================================== Installing: gpfs.gplbin-3.10.0-514.el7.x86_64 x86_64 4.2.2-3 /gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64 4.1 M Transaction Summary =================================================================================================================================================================================================================== Install 1 Package Total size: 4.1 M Installed size: 4.1 M Is this ok [y/d/N]: y Downloading packages: Running transaction check Running transaction test Transaction test succeeded Running transaction Installing : gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64 1/1 Verifying : gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64 1/1 Installed: gpfs.gplbin-3.10.0-514.el7.x86_64.x86_64 0:4.2.2-3 Complete! [root@gpfs1 desc]# Node2 또한 위와 같이 설치합니다.\n[root@gpfs1 ]# scp /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm gpfs2:/root/ gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm [root@gpfs2 ]# yum -y install /root/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm License enable\n[root@gpfs1 ~]# mmchlicense server --accept -N gpfs1,gpfs2 The following nodes will be designated as possessing server licenses: gpfs1 gpfs2 mmchlicense: Command successfully completed mmchlicense: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. [root@gpfs1 ~]# Cluster 구성 확인\n[root@gpfs1 desc]# mmlscluster GPFS cluster information ======================== GPFS cluster name: gpfscluster.gpfs1 GPFS cluster id: 12307248785610108094 GPFS UID domain: gpfscluster.gpfs1 Remote shell command: /usr/bin/ssh Remote file copy command: /usr/bin/scp Repository type: server-based GPFS cluster configuration servers: ----------------------------------- Primary server: gpfs1 Secondary server: gpfs2 Node Daemon node name IP address Admin node name Designation ---------------------------------------------------------------------- 1 gpfs1 192.168.13.200 gpfs1 quorum-manager 2 gpfs2 192.168.13.201 gpfs2 quorum-manager GPFS 서비스 시작\n[root@gpfs1 ~]# mmstartup -a Thu Apr 4 20:30:49 KST 2019: mmstartup: Starting GPFS ... [root@gpfs1 ~]# mmgetstate -a Node number Node name GPFS state ------------------------------------------ 1 gpfs1 active 2 gpfs2 active NSD Stanza File 작성\nStanza files Document : Link\n[root@gpfs1 desc]# cat disk.test.1 %nsd: device=vdb nsd=test1_nsd11 servers=gpfs1 FailureGroup=10 pool=system %nsd: device=vdb nsd=test1_nsd21 servers=gpfs2 FailureGroup=20 pool=system [root@gpfs1 desc]# cat disk.test.2 %nsd: device=vdc nsd=test2_nsd11 servers=gpfs1 FailureGroup=10 pool=system %nsd: device=vdc nsd=test2_nsd21 servers=gpfs2 FailureGroup=20 pool=system [root@gpfs1 desc]# NSD 생성\n# mmcrnsd -F disk.test.1 mmcrnsd: Processing disk vdb mmcrnsd: Processing disk vdb mmcrnsd: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. # mmcrnsd -F disk.test.2 mmcrnsd: Processing disk vdc mmcrnsd: Processing disk vdc mmcrnsd: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. NSD 생성 확인\n# mmlsnsd -X Disk name NSD volume ID Device Devtype Node name Remarks --------------------------------------------------------------------------------------------------- test1_nsd11 C0A80DC85CA5F091 /dev/vdb generic gpfs1 server node test1_nsd21 C0A80DC95CA5F093 /dev/vdb generic gpfs2 server node test2_nsd11 C0A80DC85CA5F0C5 /dev/vdc generic gpfs1 server node test2_nsd21 C0A80DC95CA5F0C6 /dev/vdc generic gpfs2 server node [root@gpfs1 desc]# GPFS 파일시스템 생성\n[root@gpfs1 desc]# mmcrfs gpfs.test1 -F disk.test.1 -A yes -B 256k -m 2 -M 2 -r 2 -R 2 -T /test1 The following disks of gpfs.2d1 will be formatted on node gpfs1: test1_nsd11: size 20480 MB test1_nsd21: size 20480 MB Formatting file system ... Disks up to size 192 GB can be added to storage pool system. Creating Inode File 5 % complete on Thu Apr 4 20:57:49 2019 10 % complete on Thu Apr 4 20:57:54 2019 16 % complete on Thu Apr 4 20:57:59 2019 21 % complete on Thu Apr 4 20:58:04 2019 26 % complete on Thu Apr 4 20:58:09 2019 31 % complete on Thu Apr 4 20:58:15 2019 36 % complete on Thu Apr 4 20:58:20 2019 41 % complete on Thu Apr 4 20:58:25 2019 46 % complete on Thu Apr 4 20:58:30 2019 51 % complete on Thu Apr 4 20:58:35 2019 56 % complete on Thu Apr 4 20:58:40 2019 62 % complete on Thu Apr 4 20:58:46 2019 67 % complete on Thu Apr 4 20:58:51 2019 72 % complete on Thu Apr 4 20:58:56 2019 77 % complete on Thu Apr 4 20:59:01 2019 83 % complete on Thu Apr 4 20:59:07 2019 88 % complete on Thu Apr 4 20:59:12 2019 93 % complete on Thu Apr 4 20:59:17 2019 98 % complete on Thu Apr 4 20:59:22 2019 100 % complete on Thu Apr 4 20:59:24 2019 Creating Allocation Maps Creating Log Files 3 % complete on Thu Apr 4 20:59:37 2019 28 % complete on Thu Apr 4 20:59:50 2019 53 % complete on Thu Apr 4 21:00:02 2019 78 % complete on Thu Apr 4 21:00:15 2019 100 % complete on Thu Apr 4 21:00:16 2019 Clearing Inode Allocation Map Clearing Block Allocation Map Formatting Allocation Map for storage pool system Completed creation of file system /dev/gpfs.test1. mmcrfs: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. [root@gpfs1 desc]# mmcrfs gpfs.test2 -F disk.test.2 -A yes -B 256k -m 2 -M 2 -r 2 -R 2 -T /test2 The following disks of gpfs.2d1 will be formatted on node gpfs1: test2_nsd11: size 20480 MB test2_nsd21: size 20480 MB Formatting file system ... Disks up to size 192 GB can be added to storage pool system. Creating Inode File 3 % complete on Thu Apr 4 21:00:58 2019 9 % complete on Thu Apr 4 21:01:03 2019 14 % complete on Thu Apr 4 21:01:09 2019 19 % complete on Thu Apr 4 21:01:14 2019 24 % complete on Thu Apr 4 21:01:19 2019 29 % complete on Thu Apr 4 21:01:25 2019 34 % complete on Thu Apr 4 21:01:30 2019 39 % complete on Thu Apr 4 21:01:36 2019 45 % complete on Thu Apr 4 21:01:41 2019 50 % complete on Thu Apr 4 21:01:47 2019 56 % complete on Thu Apr 4 21:01:52 2019 61 % complete on Thu Apr 4 21:01:58 2019 66 % complete on Thu Apr 4 21:02:03 2019 71 % complete on Thu Apr 4 21:02:08 2019 76 % complete on Thu Apr 4 21:02:13 2019 81 % complete on Thu Apr 4 21:02:18 2019 86 % complete on Thu Apr 4 21:02:23 2019 91 % complete on Thu Apr 4 21:02:28 2019 95 % complete on Thu Apr 4 21:02:33 2019 100 % complete on Thu Apr 4 21:02:37 2019 Creating Allocation Maps Creating Log Files 3 % complete on Thu Apr 4 21:02:50 2019 28 % complete on Thu Apr 4 21:03:03 2019 53 % complete on Thu Apr 4 21:03:16 2019 78 % complete on Thu Apr 4 21:03:28 2019 100 % complete on Thu Apr 4 21:03:29 2019 Clearing Inode Allocation Map Clearing Block Allocation Map Formatting Allocation Map for storage pool system Completed creation of file system /dev/gpfs.test2. mmcrfs: Propagating the cluster configuration data to all affected nodes. This is an asynchronous process. Fileset 생성\n[root@gpfs1 test1]# mmcrfileset gpfs.test1 dir1 --inode-space new --inode-limit 200000 Fileset dir1 created with id 1 root inode 131075. [root@gpfs1 test1]# mmlsfileset gpfs.test1 -L Filesets in file system 'gpfs.test1': Name Id RootInode ParentId Created InodeSpace MaxInodes AllocInodes Comment root 0 3 -- Thu Apr 4 21:00:16 2019 0 65792 65792 root fileset dir1 1 131075 -- Fri Apr 5 00:14:34 2019 1 200000 65920 [root@gpfs1 test1]# [root@gpfs1 test1]# mmdf gpfs.test1 disk disk size failure holds holds free KB free KB name in KB group metadata data in full blocks in fragments --------------- ------------- -------- -------- ----- -------------------- ------------------- Disks in storage pool: system (Maximum disk size allowed is 192 GB) test1_nsd11 20971520 10 Yes Yes 20235264 ( 96%) 824 ( 0%) test1_nsd21 20971520 20 Yes Yes 20235264 ( 96%) 824 ( 0%) ------------- -------------------- ------------------- (pool total) 41943040 40470528 ( 96%) 1648 ( 0%) ============= ==================== =================== (total) 41943040 40470528 ( 96%) 1648 ( 0%) Inode Information ----------------- Total number of used inodes in all Inode spaces: 4039 Total number of free inodes in all Inode spaces: 127673 Total number of allocated inodes in all Inode spaces: 131712 Total of Maximum number of inodes in all Inode spaces: 265792 [root@gpfs1 test1]# mmcrfileset gpfs.test1 dir2 --inode-space new --inode-limit 200000 Fileset dir2 created with id 2 root inode 262147. [root@gpfs1 test1]# mmlsfileset gpfs.test1 -L Filesets in file system 'gpfs.test1': Name Id RootInode ParentId Created InodeSpace MaxInodes AllocInodes Comment root 0 3 -- Thu Apr 4 21:00:16 2019 0 65792 65792 root fileset dir1 1 131075 -- Fri Apr 5 00:14:34 2019 1 200000 65920 dir2 2 262147 -- Fri Apr 5 00:21:25 2019 2 200000 65920 [root@gpfs1 test1]# Fileset Link 구성\n# mmlinkfileset gpfs.test1 dir1 -J /test1/dir1 Fileset Base linked at /test1/dir1 # mmlinkfileset gpfs.test1 dir2 -J /test2/dir2 Fileset Base linked at /test1/dir2 # mmlsfileset gpfs.test1 Filesets in file system 'gpfs.test1': Name Status Path root Linked /test dir1 Linked /test/dir1 dir2 Linked /test/dir2 참고 자료  IBM GPFS Document :\n https://www.ibm.com/support/knowledgecenter/STXKQY_5.0.0/com.ibm.spectrum.scale.v5r00.doc/bl1adm_stanzafiles.htm\nhttps://www.ibm.com/support/knowledgecenter/en/STXKQY_5.0.2/com.ibm.spectrum.scale.v5r02.doc/bl1adv_gpfsrep.htm\nhttps://www.ibm.com/support/knowledgecenter/en/STXKQY_4.2.1/com.ibm.spectrum.scale.v4r21.doc/bl1adv_filesets.htm\nhttps://www.ibm.com/support/knowledgecenter/en/STXKQY_5.0.2/com.ibm.spectrum.scale.v5r02.doc/bl1adm_mmrestripefs.htm\n ",
  "wordCount" : "1676",
  "inLanguage": "en",
  "datePublished": "2019-04-05T00:00:00Z",
  "dateModified": "2019-04-05T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "chhanz"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chhanz88.github.io/post/2019-04-05-linux-gpfs-hands-on-training/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "chhanz 기술 블로그\n",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chhanz88.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chhanz88.github.io" accesskey="h" title="chhanz 기술 블로그
 (Alt + H)">chhanz 기술 블로그
</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chhanz88.github.io/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://chhanz88.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      [GPFS] CentOS 7 - IBM GPFS Hands on Tranining
    </h1>
    <div class="post-description">
       
    </div>
    <div class="post-meta"><span title='2019-04-05 00:00:00 +0000 UTC'>April 5, 2019</span>&nbsp;·&nbsp;chhanz

</div>
  </header> 
  <div class="post-content"><h1 id="gpfs-centos-7---ibm-gpfs-hands-on-tranining">[GPFS] CentOS 7 - IBM GPFS Hands on Tranining<a hidden class="anchor" aria-hidden="true" href="#gpfs-centos-7---ibm-gpfs-hands-on-tranining">#</a></h1>
<h1 id="목표-hands-on-구성도">목표 Hands-on 구성도<a hidden class="anchor" aria-hidden="true" href="#목표-hands-on-구성도">#</a></h1>
<hr>
<!-- raw HTML omitted -->
<h1 id="hands-on-환경">Hands-on 환경<a hidden class="anchor" aria-hidden="true" href="#hands-on-환경">#</a></h1>
<hr>
<blockquote>
<p>OS Version : CentOS 7.3<br>
Kernel Version : 3.10.0-514.el7.x86_64<br>
GPFS Version : gpfs v4.2.2-3<br>
OS Configuration : SSH Key Copy 완료</p>
</blockquote>
<h1 id="hands-on-lab">Hands-on Lab<a hidden class="anchor" aria-hidden="true" href="#hands-on-lab">#</a></h1>
<p>Cluster 구성</p>
<pre tabindex="0"><code>[root@gpfs1 desc]# mmcrcluster -N node_desc --ccr-disable -p gpfs1 -s gpfs2 -r /usr/bin/ssh -R /usr/bin/scp -C gpfscluster
mmcrcluster: Performing preliminary node verification ...
mmcrcluster: Processing quorum and other critical nodes ...
mmcrcluster: Finalizing the cluster data structures ...
mmcrcluster: Command successfully completed
mmcrcluster: Warning: Not all nodes have proper GPFS license designations.
    Use the mmchlicense command to designate licenses as needed.
mmcrcluster: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.
[root@gpfs1 desc]#
 
[root@gpfs1 desc]# mmchlicense server --accept -N gpfs1,gpfs2
 
The following nodes will be designated as possessing server licenses:
    gpfs1
    gpfs2
mmchlicense: Command successfully completed
mmchlicense: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.
[root@gpfs1 desc]# 
</code></pre><p>GPFS portability layer 생성</p>
<pre tabindex="0"><code>[root@gpfs1 desc]# mmbuildgpl --build-package
--------------------------------------------------------
mmbuildgpl: Building GPL module begins at Thu Apr  4 20:49:28 KST 2019.
--------------------------------------------------------
Verifying Kernel Header...
  kernel version = 31000514 (3.10.0-514.el7.x86_64, 3.10.0-514)
  module include dir = /lib/modules/3.10.0-514.el7.x86_64/build/include
  module build dir   = /lib/modules/3.10.0-514.el7.x86_64/build
  kernel source dir  = /usr/src/linux-3.10.0-514.el7.x86_64/include
  Found valid kernel header file under /usr/src/kernels/3.10.0-514.el7.x86_64/include
Verifying Compiler...
  make is present at /bin/make
  cpp is present at /bin/cpp
  gcc is present at /bin/gcc
  g++ is present at /bin/g++
  ld is present at /bin/ld
Verifying rpmbuild...
Verifying Additional System Headers...
  Verifying kernel-headers is installed ...
    Command: /bin/rpm -q kernel-headers 
    The required package kernel-headers is installed
make World ...
make InstallImages ...
make rpm ...
Wrote: /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm
--------------------------------------------------------
mmbuildgpl: Building GPL module completed successfully at Thu Apr  4 20:50:08 KST 2019.
--------------------------------------------------------
[root@gpfs1 desc]# 
</code></pre><p>Node1 build 된 package 설치</p>
<pre tabindex="0"><code># yum install /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm
Loaded plugins: fastestmirror
Examining /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm: gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64
Marking /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package gpfs.gplbin-3.10.0-514.el7.x86_64.x86_64 0:4.2.2-3 will be installed
--&gt; Finished Dependency Resolution
 
Dependencies Resolved
 
===================================================================================================================================================================================================================
 Package                                                     Arch                             Version                            Repository                                                                   Size
===================================================================================================================================================================================================================
Installing:
 gpfs.gplbin-3.10.0-514.el7.x86_64                           x86_64                           4.2.2-3                            /gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64                           4.1 M
 
Transaction Summary
===================================================================================================================================================================================================================
Install  1 Package
 
Total size: 4.1 M
Installed size: 4.1 M
Is this ok [y/d/N]: y
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64                                                                                                                                                1/1
  Verifying  : gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64                                                                                                                                                1/1
 
Installed:
  gpfs.gplbin-3.10.0-514.el7.x86_64.x86_64 0:4.2.2-3                                                                                                                                                              
 
Complete!
[root@gpfs1 desc]# 
</code></pre><p>Node2 또한 위와 같이 설치합니다.</p>
<pre tabindex="0"><code>[root@gpfs1 ]# scp /root/rpmbuild/RPMS/x86_64/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm gpfs2:/root/
gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm

[root@gpfs2 ]# yum -y install /root/gpfs.gplbin-3.10.0-514.el7.x86_64-4.2.2-3.x86_64.rpm
</code></pre><p>License enable</p>
<pre tabindex="0"><code>[root@gpfs1 ~]# mmchlicense server --accept -N gpfs1,gpfs2

The following nodes will be designated as possessing server licenses:
	gpfs1
	gpfs2
mmchlicense: Command successfully completed
mmchlicense: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.
[root@gpfs1 ~]#
</code></pre><p>Cluster 구성 확인</p>
<pre tabindex="0"><code>[root@gpfs1 desc]# mmlscluster
 
GPFS cluster information
========================
  GPFS cluster name:         gpfscluster.gpfs1
  GPFS cluster id:           12307248785610108094
  GPFS UID domain:           gpfscluster.gpfs1
  Remote shell command:      /usr/bin/ssh
  Remote file copy command:  /usr/bin/scp
  Repository type:           server-based
 
GPFS cluster configuration servers:
-----------------------------------
  Primary server:    gpfs1
  Secondary server:  gpfs2
 
 Node  Daemon node name  IP address      Admin node name  Designation
----------------------------------------------------------------------
   1   gpfs1             192.168.13.200  gpfs1            quorum-manager
   2   gpfs2             192.168.13.201  gpfs2            quorum-manager
</code></pre><p>GPFS 서비스 시작</p>
<pre tabindex="0"><code>[root@gpfs1 ~]# mmstartup -a
Thu Apr  4 20:30:49 KST 2019: mmstartup: Starting GPFS ...
[root@gpfs1 ~]# mmgetstate -a
 
 Node number  Node name        GPFS state
------------------------------------------
       1      gpfs1            active
       2      gpfs2            active
</code></pre><p>NSD Stanza File 작성<br>
<em><strong>Stanza files Document : <a href="https://www.ibm.com/support/knowledgecenter/STXKQY_5.0.0/com.ibm.spectrum.scale.v5r00.doc/bl1adm_stanzafiles.htm">Link</a></strong></em></p>
<pre tabindex="0"><code>[root@gpfs1 desc]# cat disk.test.1
%nsd: device=vdb nsd=test1_nsd11 servers=gpfs1 FailureGroup=10 pool=system
%nsd: device=vdb nsd=test1_nsd21 servers=gpfs2 FailureGroup=20 pool=system
[root@gpfs1 desc]# cat disk.test.2
%nsd: device=vdc nsd=test2_nsd11 servers=gpfs1 FailureGroup=10 pool=system
%nsd: device=vdc nsd=test2_nsd21 servers=gpfs2 FailureGroup=20 pool=system
[root@gpfs1 desc]#
</code></pre><p>NSD 생성</p>
<pre tabindex="0"><code># mmcrnsd -F disk.test.1
mmcrnsd: Processing disk vdb
mmcrnsd: Processing disk vdb
mmcrnsd: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.

# mmcrnsd -F disk.test.2
mmcrnsd: Processing disk vdc
mmcrnsd: Processing disk vdc
mmcrnsd: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.
</code></pre><p>NSD 생성 확인</p>
<pre tabindex="0"><code># mmlsnsd -X
 
 Disk name    NSD volume ID      Device         Devtype  Node name                Remarks         
---------------------------------------------------------------------------------------------------
 test1_nsd11    C0A80DC85CA5F091   /dev/vdb       generic  gpfs1                    server node
 test1_nsd21    C0A80DC95CA5F093   /dev/vdb       generic  gpfs2                    server node
 test2_nsd11    C0A80DC85CA5F0C5   /dev/vdc       generic  gpfs1                    server node
 test2_nsd21    C0A80DC95CA5F0C6   /dev/vdc       generic  gpfs2                    server node
 
[root@gpfs1 desc]# 
</code></pre><p>GPFS 파일시스템 생성</p>
<pre tabindex="0"><code>[root@gpfs1 desc]# mmcrfs gpfs.test1 -F disk.test.1  -A yes -B 256k -m 2 -M 2 -r 2 -R 2 -T /test1
 
The following disks of gpfs.2d1 will be formatted on node gpfs1:
    test1_nsd11: size 20480 MB
    test1_nsd21: size 20480 MB
Formatting file system ...
Disks up to size 192 GB can be added to storage pool system.
Creating Inode File
   5 % complete on Thu Apr  4 20:57:49 2019
  10 % complete on Thu Apr  4 20:57:54 2019
  16 % complete on Thu Apr  4 20:57:59 2019
  21 % complete on Thu Apr  4 20:58:04 2019
  26 % complete on Thu Apr  4 20:58:09 2019
  31 % complete on Thu Apr  4 20:58:15 2019
  36 % complete on Thu Apr  4 20:58:20 2019
  41 % complete on Thu Apr  4 20:58:25 2019
  46 % complete on Thu Apr  4 20:58:30 2019
  51 % complete on Thu Apr  4 20:58:35 2019
  56 % complete on Thu Apr  4 20:58:40 2019
  62 % complete on Thu Apr  4 20:58:46 2019
  67 % complete on Thu Apr  4 20:58:51 2019
  72 % complete on Thu Apr  4 20:58:56 2019
  77 % complete on Thu Apr  4 20:59:01 2019
  83 % complete on Thu Apr  4 20:59:07 2019
  88 % complete on Thu Apr  4 20:59:12 2019
  93 % complete on Thu Apr  4 20:59:17 2019
  98 % complete on Thu Apr  4 20:59:22 2019
 100 % complete on Thu Apr  4 20:59:24 2019
Creating Allocation Maps
Creating Log Files
   3 % complete on Thu Apr  4 20:59:37 2019
  28 % complete on Thu Apr  4 20:59:50 2019
  53 % complete on Thu Apr  4 21:00:02 2019
  78 % complete on Thu Apr  4 21:00:15 2019
 100 % complete on Thu Apr  4 21:00:16 2019
Clearing Inode Allocation Map
Clearing Block Allocation Map
Formatting Allocation Map for storage pool system
Completed creation of file system /dev/gpfs.test1.
mmcrfs: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.

[root@gpfs1 desc]# mmcrfs gpfs.test2 -F disk.test.2  -A yes -B 256k -m 2 -M 2 -r 2 -R 2 -T /test2
 
The following disks of gpfs.2d1 will be formatted on node gpfs1:
    test2_nsd11: size 20480 MB
    test2_nsd21: size 20480 MB
Formatting file system ...
Disks up to size 192 GB can be added to storage pool system.
Creating Inode File
   3 % complete on Thu Apr  4 21:00:58 2019
   9 % complete on Thu Apr  4 21:01:03 2019
  14 % complete on Thu Apr  4 21:01:09 2019
  19 % complete on Thu Apr  4 21:01:14 2019
  24 % complete on Thu Apr  4 21:01:19 2019
  29 % complete on Thu Apr  4 21:01:25 2019
  34 % complete on Thu Apr  4 21:01:30 2019
  39 % complete on Thu Apr  4 21:01:36 2019
  45 % complete on Thu Apr  4 21:01:41 2019
  50 % complete on Thu Apr  4 21:01:47 2019
  56 % complete on Thu Apr  4 21:01:52 2019
  61 % complete on Thu Apr  4 21:01:58 2019
  66 % complete on Thu Apr  4 21:02:03 2019
  71 % complete on Thu Apr  4 21:02:08 2019
  76 % complete on Thu Apr  4 21:02:13 2019
  81 % complete on Thu Apr  4 21:02:18 2019
  86 % complete on Thu Apr  4 21:02:23 2019
  91 % complete on Thu Apr  4 21:02:28 2019
  95 % complete on Thu Apr  4 21:02:33 2019
 100 % complete on Thu Apr  4 21:02:37 2019
Creating Allocation Maps
Creating Log Files
   3 % complete on Thu Apr  4 21:02:50 2019
  28 % complete on Thu Apr  4 21:03:03 2019
  53 % complete on Thu Apr  4 21:03:16 2019
  78 % complete on Thu Apr  4 21:03:28 2019
 100 % complete on Thu Apr  4 21:03:29 2019
Clearing Inode Allocation Map
Clearing Block Allocation Map
Formatting Allocation Map for storage pool system
Completed creation of file system /dev/gpfs.test2.
mmcrfs: Propagating the cluster configuration data to all
  affected nodes.  This is an asynchronous process.
</code></pre><p>Fileset 생성</p>
<pre tabindex="0"><code>[root@gpfs1 test1]# mmcrfileset gpfs.test1 dir1 --inode-space new --inode-limit 200000
Fileset dir1 created with id 1 root inode 131075.
[root@gpfs1 test1]# mmlsfileset gpfs.test1 -L
Filesets in file system &#39;gpfs.test1&#39;:
Name                            Id      RootInode  ParentId Created                      InodeSpace      MaxInodes    AllocInodes Comment
root                             0              3        -- Thu Apr  4 21:00:16 2019        0                65792          65792 root fileset
dir1                             1         131075        -- Fri Apr  5 00:14:34 2019        1               200000          65920
[root@gpfs1 test1]#

[root@gpfs1 test1]# mmdf gpfs.test1
disk                disk size  failure holds    holds              free KB             free KB
name                    in KB    group metadata data        in full blocks        in fragments
--------------- ------------- -------- -------- ----- -------------------- -------------------
Disks in storage pool: system (Maximum disk size allowed is 192 GB)
test1_nsd11            20971520       10 Yes      Yes        20235264 ( 96%)           824 ( 0%)
test1_nsd21            20971520       20 Yes      Yes        20235264 ( 96%)           824 ( 0%)
                -------------                         -------------------- -------------------
(pool total)         41943040                              40470528 ( 96%)          1648 ( 0%)
 
                =============                         ==================== ===================
(total)              41943040                              40470528 ( 96%)          1648 ( 0%)
 
Inode Information
-----------------
Total number of used inodes in all Inode spaces:               4039
Total number of free inodes in all Inode spaces:             127673
Total number of allocated inodes in all Inode spaces:        131712
Total of Maximum number of inodes in all Inode spaces:       265792

[root@gpfs1 test1]# mmcrfileset gpfs.test1 dir2 --inode-space new --inode-limit 200000
Fileset dir2 created with id 2 root inode 262147.
[root@gpfs1 test1]# mmlsfileset gpfs.test1 -L
Filesets in file system &#39;gpfs.test1&#39;:
Name                            Id      RootInode  ParentId Created                      InodeSpace      MaxInodes    AllocInodes Comment
root                             0              3        -- Thu Apr  4 21:00:16 2019        0                65792          65792 root fileset
dir1                             1         131075        -- Fri Apr  5 00:14:34 2019        1               200000          65920
dir2                             2         262147        -- Fri Apr  5 00:21:25 2019        2               200000          65920
[root@gpfs1 test1]#
</code></pre><p>Fileset Link 구성</p>
<pre tabindex="0"><code># mmlinkfileset gpfs.test1 dir1 -J /test1/dir1
Fileset Base linked at /test1/dir1
# mmlinkfileset gpfs.test1 dir2 -J /test2/dir2
Fileset Base linked at /test1/dir2

# mmlsfileset gpfs.test1
Filesets in file system &#39;gpfs.test1&#39;:
Name                     Status    Path
root                     Linked    /test
dir1                     Linked    /test/dir1
dir2                     Linked    /test/dir2
</code></pre><h1 id="참고-자료">참고 자료<a hidden class="anchor" aria-hidden="true" href="#참고-자료">#</a></h1>
<hr>
<p><em><strong>IBM GPFS Document :</strong></em></p>
<blockquote>
<p><a href="https://www.ibm.com/support/knowledgecenter/STXKQY_5.0.0/com.ibm.spectrum.scale.v5r00.doc/bl1adm_stanzafiles.htm">https://www.ibm.com/support/knowledgecenter/STXKQY_5.0.0/com.ibm.spectrum.scale.v5r00.doc/bl1adm_stanzafiles.htm</a><br>
<a href="https://www.ibm.com/support/knowledgecenter/en/STXKQY_5.0.2/com.ibm.spectrum.scale.v5r02.doc/bl1adv_gpfsrep.htm">https://www.ibm.com/support/knowledgecenter/en/STXKQY_5.0.2/com.ibm.spectrum.scale.v5r02.doc/bl1adv_gpfsrep.htm</a><br>
<a href="https://www.ibm.com/support/knowledgecenter/en/STXKQY_4.2.1/com.ibm.spectrum.scale.v4r21.doc/bl1adv_filesets.htm">https://www.ibm.com/support/knowledgecenter/en/STXKQY_4.2.1/com.ibm.spectrum.scale.v4r21.doc/bl1adv_filesets.htm</a><br>
<a href="https://www.ibm.com/support/knowledgecenter/en/STXKQY_5.0.2/com.ibm.spectrum.scale.v5r02.doc/bl1adm_mmrestripefs.htm">https://www.ibm.com/support/knowledgecenter/en/STXKQY_5.0.2/com.ibm.spectrum.scale.v5r02.doc/bl1adm_mmrestripefs.htm</a></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://chhanz88.github.io/tags/linux/">linux</a></li>
      <li><a href="https://chhanz88.github.io/tags/GPFS/">GPFS</a></li>
    </ul>
  </footer><script src="https://utteranc.es/client.js"
        repo="chhanz88/chhanz88.github.io"
        issue-term="title"
        label="question"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://chhanz88.github.io">chhanz 기술 블로그
</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
