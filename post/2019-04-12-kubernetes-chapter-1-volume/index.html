<!DOCTYPE html>
<html lang="en" dir="auto">

<head><link rel="icon" type="image/png" href="https://chhanz88.github.io/assets/favicon.png">

</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chhanz88.github.io" accesskey="h" title="chhanz 기술 블로그
 (Alt + H)">chhanz 기술 블로그
</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chhanz88.github.io/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://chhanz88.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      [Kubernetes] Kubernetes Volume #1
    </h1>
    <div class="post-description">
      emptyDir / hostPath / gitRepo
    </div>
    <div class="post-meta"><span title='2019-04-12 00:00:00 +0000 UTC'>April 12, 2019</span>&nbsp;·&nbsp;chhanz

</div>
  </header> 
  <div class="post-content"><hr>
<p>이번 포스팅은 Kubernetes Korea Group의 Kubernetes Architecture Study 모임에서 스터디 후, 발표된 내용입니다.<br>
Link : <a href="https://github.com/grepsean/k8skr-study-architecture">k8skr-study-architecture Github</a></p>
<hr>
<h1 id="kubernetes-volume">Kubernetes Volume<a hidden class="anchor" aria-hidden="true" href="#kubernetes-volume">#</a></h1>
<hr>
<p>Kubernetes 에서 Volume 으로 사용 가능한 유형은 아래와 같습니다.</p>
<blockquote>
<ul>
<li>emptyDir</li>
<li>hostPath</li>
<li>gitRepo</li>
<li>Openstack Cinder</li>
<li>cephfs</li>
<li>iscsi</li>
<li>rbd</li>
<li>그 외 Public Cloud Storage</li>
</ul>
</blockquote>
<p>이처럼 Kubernetes 에서는 다양한 Volume 을 지원합니다.<br>
책에 소개된 emptyDir / hostPath / gitRepo 에 대해 예제와 함께 어떤식으로 사용이 되는지 확인 해보겠습니다.<br>
추가로 책에는 없는 nfs / cephfs / rbd 를 Kubernetes Volume 으로 사용 해보겠습니다.</p>
<h1 id="emptydir">emptyDir<a hidden class="anchor" aria-hidden="true" href="#emptydir">#</a></h1>
<hr>
<p>emptyDir 은 Pod 과 함께 생성되고, 삭제되는 임시 Volume 입니다.<br>
컨테이너 단위로 관리되는 것이 아니고 Pod 단위로 관리가 되기 때문에 Pod 내 컨테이너가 Error 로 인해 삭제 혹은 재시작이 되더라도 emptyDir 은 삭제가 되지 않고 계속 사용이 가능합니다.</p>
<h2 id="emptydir-예제">emptyDir 예제<a hidden class="anchor" aria-hidden="true" href="#emptydir-예제">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># cat fortuneloop.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>trap <span style="color:#e6db74">&#34;exit&#34;</span> SIGINT
</span></span><span style="display:flex;"><span>mkdir /var/htdocs
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> :
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#66d9ef">$(</span>date<span style="color:#66d9ef">)</span> Writing fortune to /var/htdocs/index.html
</span></span><span style="display:flex;"><span>    /usr/games/fortune &gt; /var/htdocs/index.html
</span></span><span style="display:flex;"><span>    sleep <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>위 스크립트를 이용해서 Docker 이미지를 Build 합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu:latest</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get update ; apt-get -y install fortune<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> fortuneloop.sh /bin/fortuneloop.sh<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENTRYPOINT</span> /bin/fortuneloop.sh<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Docker Image 를 Build 합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># docker build -t han0495/fortune .</span>
</span></span><span style="display:flex;"><span>Sending build context to Docker daemon  3.072kB
</span></span><span style="display:flex;"><span>Step 1/4 : FROM ubuntu:latest
</span></span><span style="display:flex;"><span> ---&gt; 94e814e2efa8
</span></span><span style="display:flex;"><span>Step 2/4 : RUN apt-get update ; apt-get -y install fortune
</span></span><span style="display:flex;"><span> ---&gt; Running in 3c8f694a68af
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt; 중 략 &gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Removing intermediate container 3c8f694a68af
</span></span><span style="display:flex;"><span> ---&gt; 1e8b262e7bdf
</span></span><span style="display:flex;"><span>Step 3/4 : ADD fortuneloop.sh /bin/fortuneloop.sh
</span></span><span style="display:flex;"><span> ---&gt; 3eee41108b5b
</span></span><span style="display:flex;"><span>Step 4/4 : ENTRYPOINT /bin/fortuneloop.sh
</span></span><span style="display:flex;"><span> ---&gt; Running in 082ee707cdf1
</span></span><span style="display:flex;"><span>Removing intermediate container 082ee707cdf1
</span></span><span style="display:flex;"><span> ---&gt; 58d2d430a7b4
</span></span><span style="display:flex;"><span>Successfully built 58d2d430a7b4
</span></span><span style="display:flex;"><span>Successfully tagged han0495/fortune:latest
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 inside<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><p>아래와 같은 yaml 파일을 작성합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># cat fortune.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fortune</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">han0495/fortune</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">html-generator</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">html</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/htdocs</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:alpine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">web-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">html</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/nginx/html</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">html</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">emptyDir</span>: {}
</span></span></code></pre></div><p>작성한 yaml 파일을 이용하여, Pod을 생성합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 fortune<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get po</span>
</span></span><span style="display:flex;"><span>NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>fortune                           2/2     Running   <span style="color:#ae81ff">0</span>          5m10s
</span></span><span style="display:flex;"><span>load-generator-557649ddcd-nl6js   1/1     Running   <span style="color:#ae81ff">1</span>          6d18h
</span></span><span style="display:flex;"><span>php-apache-9bd5c887f-nm4h5        1/1     Running   <span style="color:#ae81ff">0</span>          6d18h
</span></span><span style="display:flex;"><span>tomcat-f94554bb9-gkhpz            1/1     Running   <span style="color:#ae81ff">0</span>          7d
</span></span><span style="display:flex;"><span>web-7d77974d4c-gd76n              1/1     Running   <span style="color:#ae81ff">0</span>          7d2h
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 fortune<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe po fortune</span>
</span></span><span style="display:flex;"><span>Name:               fortune
</span></span><span style="display:flex;"><span>Namespace:          default
</span></span><span style="display:flex;"><span>Priority:           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>PriorityClassName:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Node:               w03/192.168.13.16
</span></span><span style="display:flex;"><span>Start Time:         Mon, <span style="color:#ae81ff">08</span> Apr <span style="color:#ae81ff">2019</span> 17:41:40 +0900
</span></span><span style="display:flex;"><span>Labels:             &lt;none&gt;
</span></span><span style="display:flex;"><span>Annotations:        &lt;none&gt;
</span></span><span style="display:flex;"><span>Status:             Running
</span></span><span style="display:flex;"><span>IP:                 10.233.89.8
</span></span><span style="display:flex;"><span>Containers:
</span></span><span style="display:flex;"><span>  html-generator:
</span></span><span style="display:flex;"><span>    Container ID:   docker://e25bc8c3b94a2a02edc8b983eb77214a4644a99a3931c1f96f131819060cc676
</span></span><span style="display:flex;"><span>    Image:          han0495/fortune
</span></span><span style="display:flex;"><span>    Image ID:       docker-pullable://han0495/fortune@sha256:63d5786a84e67dcd5eec70d516d5788c8e3c3a90d23f23bec1825f7a4526bb00
</span></span><span style="display:flex;"><span>    Port:           &lt;none&gt;
</span></span><span style="display:flex;"><span>    Host Port:      &lt;none&gt;
</span></span><span style="display:flex;"><span>    State:          Running
</span></span><span style="display:flex;"><span>      Started:      Mon, <span style="color:#ae81ff">08</span> Apr <span style="color:#ae81ff">2019</span> 17:42:01 +0900
</span></span><span style="display:flex;"><span>    Ready:          True
</span></span><span style="display:flex;"><span>    Restart Count:  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    Environment:    &lt;none&gt;
</span></span><span style="display:flex;"><span>    Mounts:
</span></span><span style="display:flex;"><span>      /var/htdocs from html <span style="color:#f92672">(</span>rw<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-vt6hm <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  web-server:
</span></span><span style="display:flex;"><span>    Container ID:   docker://ed7c2fd5adbb919fde6ed01d1a80fa74df689d1aa99bc8d883b1b68ed918dd09
</span></span><span style="display:flex;"><span>    Image:          nginx:alpine
</span></span><span style="display:flex;"><span>    Image ID:       docker-pullable://nginx@sha256:d5e177fed5e4f264e55b19b84bdc494078a06775612a4f60963f296756ea83aa
</span></span><span style="display:flex;"><span>    Port:           80/TCP
</span></span><span style="display:flex;"><span>    Host Port:      0/TCP
</span></span><span style="display:flex;"><span>    State:          Running
</span></span><span style="display:flex;"><span>      Started:      Mon, <span style="color:#ae81ff">08</span> Apr <span style="color:#ae81ff">2019</span> 17:42:09 +0900
</span></span><span style="display:flex;"><span>    Ready:          True
</span></span><span style="display:flex;"><span>    Restart Count:  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    Environment:    &lt;none&gt;
</span></span><span style="display:flex;"><span>    Mounts:
</span></span><span style="display:flex;"><span>      /usr/share/nginx/html from html <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-vt6hm <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Conditions:
</span></span><span style="display:flex;"><span>  Type              Status
</span></span><span style="display:flex;"><span>  Initialized       True
</span></span><span style="display:flex;"><span>  Ready             True
</span></span><span style="display:flex;"><span>  ContainersReady   True
</span></span><span style="display:flex;"><span>  PodScheduled      True
</span></span><span style="display:flex;"><span>Volumes:
</span></span><span style="display:flex;"><span>  html:
</span></span><span style="display:flex;"><span>    Type:    EmptyDir <span style="color:#f92672">(</span>a temporary directory that shares a pod<span style="color:#960050;background-color:#1e0010">&#39;</span>s lifetime<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    Medium:
</span></span><span style="display:flex;"><span>  default-token-vt6hm:
</span></span><span style="display:flex;"><span>    Type:        Secret <span style="color:#f92672">(</span>a volume populated by a Secret<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    SecretName:  default-token-vt6hm
</span></span><span style="display:flex;"><span>    Optional:    false
</span></span><span style="display:flex;"><span>QoS Class:       BestEffort
</span></span><span style="display:flex;"><span>Node-Selectors:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Tolerations:     node.kubernetes.io/not-ready:NoExecute <span style="color:#66d9ef">for</span> 300s
</span></span><span style="display:flex;"><span>                 node.kubernetes.io/unreachable:NoExecute <span style="color:#66d9ef">for</span> 300s
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type    Reason     Age    From               Message
</span></span><span style="display:flex;"><span>  ----    ------     ----   ----               -------
</span></span><span style="display:flex;"><span>  Normal  Scheduled  5m26s  default-scheduler  Successfully assigned default/fortune to w03
</span></span><span style="display:flex;"><span>  Normal  Pulling    5m23s  kubelet, w03       pulling image <span style="color:#e6db74">&#34;han0495/fortune&#34;</span>
</span></span><span style="display:flex;"><span>  Normal  Pulled     5m5s   kubelet, w03       Successfully pulled image <span style="color:#e6db74">&#34;han0495/fortune&#34;</span>
</span></span><span style="display:flex;"><span>  Normal  Created    5m5s   kubelet, w03       Created container
</span></span><span style="display:flex;"><span>  Normal  Started    5m4s   kubelet, w03       Started container
</span></span><span style="display:flex;"><span>  Normal  Pulling    5m4s   kubelet, w03       pulling image <span style="color:#e6db74">&#34;nginx:alpine&#34;</span>
</span></span><span style="display:flex;"><span>  Normal  Pulled     4m56s  kubelet, w03       Successfully pulled image <span style="color:#e6db74">&#34;nginx:alpine&#34;</span>
</span></span><span style="display:flex;"><span>  Normal  Created    4m56s  kubelet, w03       Created container
</span></span><span style="display:flex;"><span>  Normal  Started    4m56s  kubelet, w03       Started container
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 fortune<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><p>실제로 파일이 Docker 이미지에 넣은 스크립트가 동작하는지 확인합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 fortune<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl exec -ti fortune /bin/bash</span>
</span></span><span style="display:flex;"><span>Defaulting container name to html-generator.
</span></span><span style="display:flex;"><span>Use <span style="color:#e6db74">&#39;kubectl describe pod/fortune -n default&#39;</span> to see all of the containers in this pod.
</span></span><span style="display:flex;"><span>root@fortune:/#
</span></span><span style="display:flex;"><span>root@fortune:/# cd /var
</span></span><span style="display:flex;"><span>root@fortune:/var# cd htdocs/
</span></span><span style="display:flex;"><span>root@fortune:/var/htdocs# ls
</span></span><span style="display:flex;"><span>index.html
</span></span><span style="display:flex;"><span>root@fortune:/var/htdocs#
</span></span><span style="display:flex;"><span>root@fortune:/var/htdocs# cat index.html
</span></span><span style="display:flex;"><span>You are standing on my toes.
</span></span><span style="display:flex;"><span>root@fortune:/var/htdocs# <span style="color:#66d9ef">while</span> true
</span></span><span style="display:flex;"><span>&gt; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>&gt; date
</span></span><span style="display:flex;"><span>&gt; cat index.html
</span></span><span style="display:flex;"><span>&gt; sleep <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>&gt; <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>Mon Apr  <span style="color:#ae81ff">8</span> 08:48:43 UTC <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>Artistic ventures highlighted.  Rob a museum.
</span></span><span style="display:flex;"><span>Mon Apr  <span style="color:#ae81ff">8</span> 08:48:53 UTC <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>Never reveal your best argument.
</span></span><span style="display:flex;"><span>Mon Apr  <span style="color:#ae81ff">8</span> 08:49:03 UTC <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>You can create your own opportunities this week.  Blackmail a senior executive.
</span></span><span style="display:flex;"><span>Mon Apr  <span style="color:#ae81ff">8</span> 08:49:13 UTC <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>You have a strong appeal <span style="color:#66d9ef">for</span> members of the opposite sex.
</span></span><span style="display:flex;"><span>Mon Apr  <span style="color:#ae81ff">8</span> 08:49:23 UTC <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>You will be reincarnated as a toad; and you will be much happier.
</span></span><span style="display:flex;"><span>^C
</span></span><span style="display:flex;"><span>root@fortune:/var/htdocs#
</span></span></code></pre></div><h1 id="hostpath">hostPath<a hidden class="anchor" aria-hidden="true" href="#hostpath">#</a></h1>
<hr>
<p>hostPath는 로컬 디스크의 경로를 Pod 에 Mount 해서 사용하는 Volume 방식입니다.<br>
Docker 에서 -v 옵션으로 Volume 을 연결하는 것과 동일하다고 생각하면 됩니다.</p>
<h2 id="hostpath-예제">hostPath 예제<a hidden class="anchor" aria-hidden="true" href="#hostpath-예제">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># cat hostpath-pod.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hostpath</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">volumepath</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/nginx/html</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name </span>: <span style="color:#ae81ff">volumepath</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/imsi</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Directory</span>
</span></span></code></pre></div><p>nginx 의 index Directory 에 /imsi 라는 로컬 디스크 경로를 Mount 합니다.<br>
이후 Pod 을 해당 yaml 을 이용해서 구동합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 pod-example<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl exec -ti hostpath -- /bin/bash</span>
</span></span><span style="display:flex;"><span>root@hostpath:/#
</span></span><span style="display:flex;"><span>root@hostpath:/# ls
</span></span><span style="display:flex;"><span>bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</span></span><span style="display:flex;"><span>root@hostpath:/#
</span></span><span style="display:flex;"><span>root@hostpath:/# cd /usr
</span></span><span style="display:flex;"><span>root@hostpath:/usr# cd share/
</span></span><span style="display:flex;"><span>root@hostpath:/usr/share# cd nginx/
</span></span><span style="display:flex;"><span>root@hostpath:/usr/share/nginx# cd html/
</span></span><span style="display:flex;"><span>root@hostpath:/usr/share/nginx/html# ls
</span></span><span style="display:flex;"><span>root@hostpath:/usr/share/nginx/html#
</span></span><span style="display:flex;"><span>root@hostpath:/usr/share/nginx/html# touch test
</span></span><span style="display:flex;"><span>root@hostpath:/usr/share/nginx/html# exit
</span></span><span style="display:flex;"><span>exit
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 pod-example<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><p>Pod 이 구동된 Worker의 로컬 디스크 /imsi 경로를 확인해보면 아래와 같이 파일이 생성된 것을 확인 할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -la /imsi</span>
</span></span><span style="display:flex;"><span>합계 <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>drwxrwxrwx   <span style="color:#ae81ff">2</span> root root  <span style="color:#ae81ff">18</span>  4월  <span style="color:#ae81ff">9</span> 13:15 .
</span></span><span style="display:flex;"><span>dr-xr-xr-x. <span style="color:#ae81ff">18</span> root root <span style="color:#ae81ff">256</span>  4월  <span style="color:#ae81ff">9</span> 09:45 ..
</span></span><span style="display:flex;"><span>-rw-r--r--   <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">0</span>  4월  <span style="color:#ae81ff">9</span> 13:15 test
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><h1 id="gitrepo">gitRepo<a hidden class="anchor" aria-hidden="true" href="#gitrepo">#</a></h1>
<hr>
<p>gitRepo 는 github에 있는 Repository 에서 Source 를 Clone 하고 해당 Clone 된 데이터를 Pod 의 Volume으로 할당합니다.</p>
<h1 id="gitrepo-예제">gitRepo 예제<a hidden class="anchor" aria-hidden="true" href="#gitrepo-예제">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># cat git-http.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitrepo-httpd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">httpd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">web-server</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">html</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/local/apache2/htdocs</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readOnly</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">html</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gitRepo</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">repository</span>: <span style="color:#ae81ff">https://github.com/chhanz/docker_training.git</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">revision</span>: <span style="color:#ae81ff">master</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">directory</span>: <span style="color:#ae81ff">.</span>
</span></span></code></pre></div><p>위와 같이 Github에서 docker_training.git Source를 Clone 합니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 tmp<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe po gitrepo-httpd</span>
</span></span><span style="display:flex;"><span>Name:               gitrepo-httpd
</span></span><span style="display:flex;"><span>Namespace:          default
</span></span><span style="display:flex;"><span>Priority:           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>PriorityClassName:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Node:               w02/192.168.13.15
</span></span><span style="display:flex;"><span>Start Time:         Mon, <span style="color:#ae81ff">08</span> Apr <span style="color:#ae81ff">2019</span> 21:51:43 +0900
</span></span><span style="display:flex;"><span>Labels:             &lt;none&gt;
</span></span><span style="display:flex;"><span>Annotations:        &lt;none&gt;
</span></span><span style="display:flex;"><span>Status:             Pending
</span></span><span style="display:flex;"><span>IP:
</span></span><span style="display:flex;"><span>Containers:
</span></span><span style="display:flex;"><span>  web-server:
</span></span><span style="display:flex;"><span>    Container ID:
</span></span><span style="display:flex;"><span>    Image:          nginx:alpine
</span></span><span style="display:flex;"><span>    Image ID:
</span></span><span style="display:flex;"><span>    Port:           80/TCP
</span></span><span style="display:flex;"><span>    Host Port:      0/TCP
</span></span><span style="display:flex;"><span>    State:          Waiting
</span></span><span style="display:flex;"><span>      Reason:       ContainerCreating
</span></span><span style="display:flex;"><span>    Ready:          False
</span></span><span style="display:flex;"><span>    Restart Count:  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    Environment:    &lt;none&gt;
</span></span><span style="display:flex;"><span>    Mounts:
</span></span><span style="display:flex;"><span>      /usr/share/nginx/html from html <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-vt6hm <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Conditions:
</span></span><span style="display:flex;"><span>  Type              Status
</span></span><span style="display:flex;"><span>  Initialized       True
</span></span><span style="display:flex;"><span>  Ready             False
</span></span><span style="display:flex;"><span>  ContainersReady   False
</span></span><span style="display:flex;"><span>  PodScheduled      True
</span></span><span style="display:flex;"><span>Volumes:
</span></span><span style="display:flex;"><span>  html:
</span></span><span style="display:flex;"><span>    Type:        GitRepo <span style="color:#f92672">(</span>a volume that is pulled from git when the pod is created<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    Repository:  https://github.com/chhanz/docker_training.git
</span></span><span style="display:flex;"><span>    Revision:    master
</span></span><span style="display:flex;"><span>  default-token-vt6hm:
</span></span><span style="display:flex;"><span>    Type:        Secret <span style="color:#f92672">(</span>a volume populated by a Secret<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    SecretName:  default-token-vt6hm
</span></span><span style="display:flex;"><span>    Optional:    false
</span></span><span style="display:flex;"><span>QoS Class:       BestEffort
</span></span><span style="display:flex;"><span>Node-Selectors:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Tolerations:     node.kubernetes.io/not-ready:NoExecute <span style="color:#66d9ef">for</span> 300s
</span></span><span style="display:flex;"><span>                 node.kubernetes.io/unreachable:NoExecute <span style="color:#66d9ef">for</span> 300s
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type     Reason       Age              From               Message
</span></span><span style="display:flex;"><span>  ----     ------       ----             ----               -------
</span></span><span style="display:flex;"><span>  Normal   Scheduled    6s               default-scheduler  Successfully assigned default/gitrepo-httpd to w02
</span></span><span style="display:flex;"><span>  Warning  FailedMount  1s <span style="color:#f92672">(</span>x4 over 5s<span style="color:#f92672">)</span>  kubelet, w02       MountVolume.SetUp failed <span style="color:#66d9ef">for</span> volume <span style="color:#e6db74">&#34;html&#34;</span> : failed to exec <span style="color:#e6db74">&#39;git clone -- https://github.com/chhanz/docker_training.git .&#39;</span>: : executable file not found in $PATH
</span></span></code></pre></div><p>위와 같이 에러가 발생하며, Volume 이 Mount 가 안되었습니다.<br>
이유는 Pod 이 실행될 Worker 노드에 git 명령어가 없어서 발생된 에러였습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 gitrepo-pv<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl describe po gitrepo-httpd</span>
</span></span><span style="display:flex;"><span>Name:               gitrepo-httpd
</span></span><span style="display:flex;"><span>Namespace:          default
</span></span><span style="display:flex;"><span>Priority:           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>PriorityClassName:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Node:               w01/192.168.13.14
</span></span><span style="display:flex;"><span>Start Time:         Mon, <span style="color:#ae81ff">08</span> Apr <span style="color:#ae81ff">2019</span> 21:58:23 +0900
</span></span><span style="display:flex;"><span>Labels:             &lt;none&gt;
</span></span><span style="display:flex;"><span>Annotations:        &lt;none&gt;
</span></span><span style="display:flex;"><span>Status:             Running
</span></span><span style="display:flex;"><span>IP:                 10.233.118.8
</span></span><span style="display:flex;"><span>Containers:
</span></span><span style="display:flex;"><span>  web-server:
</span></span><span style="display:flex;"><span>    Container ID:   docker://38158075431bab4e7cfe22e34b615e66ac04e37ad7832a531d811cd67b27962a
</span></span><span style="display:flex;"><span>    Image:          httpd
</span></span><span style="display:flex;"><span>    Image ID:       docker-pullable://httpd@sha256:b4096b744d92d1825a36b3ace61ef4caa2ba57d0307b985cace4621139c285f7
</span></span><span style="display:flex;"><span>    Port:           80/TCP
</span></span><span style="display:flex;"><span>    Host Port:      0/TCP
</span></span><span style="display:flex;"><span>    State:          Running
</span></span><span style="display:flex;"><span>      Started:      Mon, <span style="color:#ae81ff">08</span> Apr <span style="color:#ae81ff">2019</span> 21:58:49 +0900
</span></span><span style="display:flex;"><span>    Ready:          True
</span></span><span style="display:flex;"><span>    Restart Count:  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    Environment:    &lt;none&gt;
</span></span><span style="display:flex;"><span>    Mounts:
</span></span><span style="display:flex;"><span>      /usr/local/apache2/htdocs from html <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      /var/run/secrets/kubernetes.io/serviceaccount from default-token-vt6hm <span style="color:#f92672">(</span>ro<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Conditions:
</span></span><span style="display:flex;"><span>  Type              Status
</span></span><span style="display:flex;"><span>  Initialized       True
</span></span><span style="display:flex;"><span>  Ready             True
</span></span><span style="display:flex;"><span>  ContainersReady   True
</span></span><span style="display:flex;"><span>  PodScheduled      True
</span></span><span style="display:flex;"><span>Volumes:
</span></span><span style="display:flex;"><span>  html:
</span></span><span style="display:flex;"><span>    Type:        GitRepo <span style="color:#f92672">(</span>a volume that is pulled from git when the pod is created<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    Repository:  https://github.com/chhanz/docker_training.git
</span></span><span style="display:flex;"><span>    Revision:    master
</span></span><span style="display:flex;"><span>  default-token-vt6hm:
</span></span><span style="display:flex;"><span>    Type:        Secret <span style="color:#f92672">(</span>a volume populated by a Secret<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    SecretName:  default-token-vt6hm
</span></span><span style="display:flex;"><span>    Optional:    false
</span></span><span style="display:flex;"><span>QoS Class:       BestEffort
</span></span><span style="display:flex;"><span>Node-Selectors:  &lt;none&gt;
</span></span><span style="display:flex;"><span>Tolerations:     node.kubernetes.io/not-ready:NoExecute <span style="color:#66d9ef">for</span> 300s
</span></span><span style="display:flex;"><span>                 node.kubernetes.io/unreachable:NoExecute <span style="color:#66d9ef">for</span> 300s
</span></span><span style="display:flex;"><span>Events:
</span></span><span style="display:flex;"><span>  Type    Reason     Age   From               Message
</span></span><span style="display:flex;"><span>  ----    ------     ----  ----               -------
</span></span><span style="display:flex;"><span>  Normal  Scheduled  28s   default-scheduler  Successfully assigned default/gitrepo-httpd to w01
</span></span><span style="display:flex;"><span>  Normal  Pulling    21s   kubelet, w01       pulling image <span style="color:#e6db74">&#34;httpd&#34;</span>
</span></span><span style="display:flex;"><span>  Normal  Pulled     0s    kubelet, w01       Successfully pulled image <span style="color:#e6db74">&#34;httpd&#34;</span>
</span></span><span style="display:flex;"><span>  Normal  Created    0s    kubelet, w01       Created container
</span></span><span style="display:flex;"><span>  Normal  Started    0s    kubelet, w01       Started container
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 gitrepo-pv<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get po</span>
</span></span><span style="display:flex;"><span>NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>fortune                           2/2     Running   <span style="color:#ae81ff">0</span>          4h17m
</span></span><span style="display:flex;"><span>gitrepo-httpd                     1/1     Running   <span style="color:#ae81ff">0</span>          33s
</span></span><span style="display:flex;"><span>load-generator-557649ddcd-nl6js   1/1     Running   <span style="color:#ae81ff">1</span>          6d22h
</span></span><span style="display:flex;"><span>php-apache-9bd5c887f-nm4h5        1/1     Running   <span style="color:#ae81ff">0</span>          6d22h
</span></span><span style="display:flex;"><span>tomcat-f94554bb9-gkhpz            1/1     Running   <span style="color:#ae81ff">0</span>          7d4h
</span></span><span style="display:flex;"><span>web-7d77974d4c-gd76n              1/1     Running   <span style="color:#ae81ff">0</span>          7d6h
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 gitrepo-pv<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><p>위와 같이 Worker 노드에 git 명령을 설치한 이후, 정상적으로 Volume 이 Mount 되는 것을 확인 할 수 있었습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 /<span style="color:#f92672">]</span><span style="color:#75715e"># find * | grep index.html</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>var/lib/kubelet/pods/fcd69917-59fd-11e9-a751-001a4a160172/volumes/kubernetes.io~git-repo/html/index.html
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 /<span style="color:#f92672">]</span><span style="color:#75715e"># cd var/lib/kubelet/pods/fcd69917-59fd-11e9-a751-001a4a160172/volumes/kubernetes.io~git-repo/html/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 html<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>copy.html  index.html  README.md  util
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 html<span style="color:#f92672">]</span><span style="color:#75715e"># ls -la</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>drwxrwxrwx <span style="color:#ae81ff">4</span> root root   <span style="color:#ae81ff">82</span> Apr  <span style="color:#ae81ff">8</span> 21:58 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">3</span> root root   <span style="color:#ae81ff">18</span> Apr  <span style="color:#ae81ff">8</span> 21:58 ..
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">2070</span> Apr  <span style="color:#ae81ff">8</span> 21:58 copy.html
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">8</span> root root  <span style="color:#ae81ff">180</span> Apr  <span style="color:#ae81ff">8</span> 21:58 .git
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">9594</span> Apr  <span style="color:#ae81ff">8</span> 21:58 index.html
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">108</span> Apr  <span style="color:#ae81ff">8</span> 21:58 README.md
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> root root   <span style="color:#ae81ff">23</span> Apr  <span style="color:#ae81ff">8</span> 21:58 util
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 html<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 html<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 html<span style="color:#f92672">]</span><span style="color:#75715e"># cat README.md</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Docker Training ReadMe</span>
</span></span><span style="display:flex;"><span>Custumer training page
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> - index.html
</span></span><span style="display:flex;"><span> - copy.html     // Copy&amp;Paste
</span></span><span style="display:flex;"><span> - putty.exe
</span></span></code></pre></div><p>위와 같이 Worker 노드에 해당 git Source 를 Clone 하고 Pod 에 Mount 된 것을 확인 할 수 있었습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">## Master Node</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@m01 gitrepo-pv<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl delete -f git-http.yml</span>
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;gitrepo-httpd&#34;</span> deleted
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">## Worker Node</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 kubernetes.io~git-repo<span style="color:#f92672">]</span><span style="color:#75715e"># cd ..</span>
</span></span><span style="display:flex;"><span>cd: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e"># ls -la</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/var/lib/kubelet/pods/fcd69917-59fd-11e9-a751-001a4a160172/volumes/kubernetes.io~git-repo/..
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e"># cd ..</span>
</span></span><span style="display:flex;"><span>cd: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e"># ls -la /var/lib/kubelet/pods/fcd69917-59fd-11e9-a751-001a4a160172/</span>
</span></span><span style="display:flex;"><span>ls: cannot access /var/lib/kubelet/pods/fcd69917-59fd-11e9-a751-001a4a160172/: No such file or directory
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@w01 ..<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><p>이처럼 해당 Pod이 삭제되면 Clone 된 Git Source는 삭제가 되는 것을 확인 하였습니다.<br>
위 테스트를 진행해보니 Git Source 를 Clone 만하고 Github Repository를 계속 Sync하는 것은 아닌 것으로 확인 하였습니다.</p>
<p>지금까지 emptyDir / hostPath / gitRepo 에 대해 예제를 통해 확인 하였습니다.<br>
nfs / cephfs / rbd 은 다음 포스팅에서 이어서 설명하도록 하겠습니다.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://chhanz88.github.io/tags/kubernetes/">kubernetes</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://chhanz88.github.io">chhanz 기술 블로그
</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
